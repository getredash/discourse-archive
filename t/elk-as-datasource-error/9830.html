<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>ELK as Datasource Error</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/elk-as-datasource-error/9830">ELK as Datasource Error</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/6.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Support</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="ELK as Datasource Error" itemprop="headline"/>
<meta content="Support" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/thiborges.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/thiborges_avatar.png" tabindex="-1" width="48"/><span itemprop="name">thiborges</span></a>
</span>
<link href="assets/9830" itemprop="mainEntityOfPage"/>
<link href="assets/f82896fcdcf5be3503025c398898b1398cf273a4.png" itemprop="image"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2022-01-12T21:33:42Z" itemprop="datePublished">
                    January 12, 2022,  9:33pm
                  </time>
<meta content="2022-01-18T21:12:51Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Hello !</p>
<p>I’m Trying add one ELK as a datasource</p>
<p>The connection works good !</p>
<p>But When I try see the Schema show a error</p>
<p><div class="lightbox-wrapper"><a class="lightbox" data-download-href="/uploads/short-url/zpjniZoB9aqRU1Qs5hqq08Ky47i.png?dl=1" href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/2X/f/f82896fcdcf5be3503025c398898b1398cf273a4.png" rel="noopener nofollow ugc" title="image"><img alt="image" data-base62-sha1="zpjniZoB9aqRU1Qs5hqq08Ky47i" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/2X/f/f82896fcdcf5be3503025c398898b1398cf273a4_2_10x10.png" height="330" src="assets/f82896fcdcf5be3503025c398898b1398cf273a4_2_690x330.png" srcset="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/2X/f/f82896fcdcf5be3503025c398898b1398cf273a4_2_690x330.png, https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/2X/f/f82896fcdcf5be3503025c398898b1398cf273a4_2_1035x495.png 1.5x, https://global.discourse-cdn.com/standard17/uploads/redash1/original/2X/f/f82896fcdcf5be3503025c398898b1398cf273a4.png 2x" width="690"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1365×653 19.8 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>On the logs I’ve the error below</p>
<pre><code class="lang-auto">[2022-01-12 21:15:46,654][PID:5162][WARNING][ForkPoolWorker-56758] task_name=redash.tasks.refresh_schema task_id=3d1cb444-12aa-40d2-9c29-29ca957fe2cb Failed refreshing schema for the data source: Swapback

1/12/2022 6:15:46 PM Traceback (most recent call last):

1/12/2022 6:15:46 PM File "/app/redash/tasks/queries.py", line 261, in refresh_schema

1/12/2022 6:15:46 PM ds.get_schema(refresh=True)

1/12/2022 6:15:46 PM File "/app/redash/models/__init__.py", line 155, in get_schema

1/12/2022 6:15:46 PM schema = sorted(query_runner.get_schema(get_stats=refresh), key=lambda t: t['name'])

1/12/2022 6:15:46 PM File "/app/redash/query_runner/__init__.py", line 142, in get_schema

1/12/2022 6:15:46 PM self._get_tables(schema_dict)


1/12/2022 6:15:46 PM File "/app/redash/query_runner/mssql.py", line 95, in _get_tables

1/12/2022 6:15:46 PM raise Exception("Failed getting schema.")

1/12/2022 6:15:46 PM Exception: Failed getting schema.

[2022-01-12 21:15:46,725][PID:5172][WARNING][ForkPoolWorker-56768] task_name=redash.tasks.refresh_schema task_id=f1a41e5e-d13f-46f3-8aae-5df50f599ab2 Failed refreshing schema for the data source: vpc

1/12/2022 6:15:46 PM Traceback (most recent call last):

1/12/2022 6:15:46 PM File "/app/redash/tasks/queries.py", line 261, in refresh_schema

1/12/2022 6:15:46 PM ds.get_schema(refresh=True)

1/12/2022 6:15:46 PM File "/app/redash/models/__init__.py", line 155, in get_schema

1/12/2022 6:15:46 PM schema = sorted(query_runner.get_schema(get_stats=refresh), key=lambda t: t['name'])

1/12/2022 6:15:46 PM File "/app/redash/query_runner/elasticsearch.py", line 173, in get_schema

1/12/2022 6:15:46 PM columns.extend(parse_doc(items))

1/12/2022 6:15:46 PM File "/app/redash/query_runner/elasticsearch.py", line 154, in parse_doc

1/12/2022 6:15:46 PM for field, description in doc['properties'].items():

1/12/2022 6:15:46 PM KeyError: 'properties'

Traceback (most recent call last):

1/12/2022 6:15:46 PM File "/app/redash/tasks/queries.py", line 261, in refresh_schema

1/12/2022 6:15:46 PM ds.get_schema(refresh=True)

1/12/2022 6:15:46 PM File "/app/redash/models/__init__.py", line 155, in get_schema

1/12/2022 6:15:46 PM schema = sorted(query_runner.get_schema(get_stats=refresh), key=lambda t: t['name'])

1/12/2022 6:15:46 PM File "/app/redash/query_runner/mongodb.py", line 217, in get_schema

1/12/2022 6:15:46 PM columns = self._get_collection_fields(db, collection_name)

1/12/2022 6:15:46 PM File "/app/redash/query_runner/mongodb.py", line 204, in _get_collection_fields

1/12/2022 6:15:46 PM for d in db[collection_name].find().sort([("$natural", -1)]).limit(1):

1/12/2022 6:15:46 PM File "/usr/local/lib/python2.7/site-packages/pymongo/cursor.py", line 1169, in next

1/12/2022 6:15:46 PM if len(self.__data) or self._refresh():

1/12/2022 6:15:46 PM File "/usr/local/lib/python2.7/site-packages/pymongo/cursor.py", line 1085, in _refresh

1/12/2022 6:15:46 PM self.__send_message(q)

1/12/2022 6:15:46 PM File "/usr/local/lib/python2.7/site-packages/pymongo/cursor.py", line 975, in __send_message

1/12/2022 6:15:46 PM helpers._check_command_response(first)

1/12/2022 6:15:46 PM File "/usr/local/lib/python2.7/site-packages/pymongo/helpers.py", line 145, in _check_command_response

1/12/2022 6:15:46 PM raise OperationFailure(msg % errmsg, code, response)

1/12/2022 6:15:46 PM OperationFailure: {$natural: -1} is not supported
</code></pre>
<p>Any ideas how to fix it ?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/jesse.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/jesse_avatar.png" tabindex="-1" width="48"/><span itemprop="name">jesse</span></a>
</span>
<link href="assets/9830" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2022-01-18T21:14:49Z" itemprop="datePublished">
                    January 18, 2022,  9:14pm
                  </time>
<meta content="2022-01-18T21:14:49Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hmmm I’m not familiar with the ELK query runner but this may be a version mismatch: i.e. Redash is expecting to query some version of ELK that’s different from yours. If this reproduces on V10 of Redash we can open an issue for it. It appears you’re running V8 which is no longer supported.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/thiborges.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/thiborges_avatar.png" tabindex="-1" width="48"/><span itemprop="name">thiborges</span></a>
</span>
<link href="assets/9830" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2022-02-03T22:03:40Z" itemprop="datePublished">
                    February 3, 2022, 10:03pm
                  </time>
<meta content="2022-02-03T22:03:40Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks Jesse…</p>
<p>I will try upgrade my version and test…</p>
<p>I let you know</p>
<p>Regards</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>