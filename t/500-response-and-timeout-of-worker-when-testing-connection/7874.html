<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>500 Response and Timeout of Worker when Testing Connection</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/500-response-and-timeout-of-worker-when-testing-connection/7874">500 Response and Timeout of Worker when Testing Connection</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/6.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Support</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/support-self-hosted/9.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Self Hosted Redash Support</span>
</span>
</a>
<meta content="2" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="500 Response and Timeout of Worker when Testing Connection" itemprop="headline"/>
<meta content="Self Hosted Redash Support" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/chiliconcatne.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/chiliconcatne_avatar.png" tabindex="-1" width="48"/><span itemprop="name">chiliconcatne</span></a>
</span>
<link href="https://discuss.redash.io/t/500-response-and-timeout-of-worker-when-testing-connection/7874" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-01-22T10:35:05Z" itemprop="datePublished">
                    January 22, 2021, 10:35am
                  </time>
<meta content="2021-01-22T11:03:30Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<h3>Issue Summary</h3>
<p>500 error code and worker timeout when testing connection</p>
<h3>Technical details:</h3>
<ul>
<li>Redash Version: Version: 9.0.0-beta (8d548ecb)</li>
<li>Browser/OS: Windows 10</li>
<li>How did you install Redash: Docker-compose</li>
</ul>
<p>Hi,</p>
<p>We have a self hosted instance of v9 redash set up on an internal docker host. However, when trying to test the connection of any MSSQL (not ODBC) and prometheus data sources (I have not tried other sources) I get the following output after 30 seconds:</p>
<pre><code>server_1        | [2021-01-22 10:08:24 +0000] [1] [CRITICAL] WORKER TIMEOUT (pid:74)
server_1        | [2021-01-22 10:08:24,894][PID:74][INFO][metrics] method=POST path=/api/data_sources/1/test endpoint=datasourcetestresource status=500 content_type=? content_length=-1 duration=30681.67 query_count=4 query_duration=7.25
server_1        | [2021-01-22 10:08:24 +0000] [74] [INFO] Worker exiting (pid: 74)
server_1        | [2021-01-22 10:08:25 +0000] [86] [INFO] Booting worker with pid: 86
</code></pre>
<p>I noticed a similar topic raised with the same output, but this used kubernetes and was a result of ingress (<a class="inline-onebox" href="http://discuss.redash.io/t/test-connection-api-data-sources-9-test-bad-gateway/7117">[TEST CONNECTION] api/data_sources/9/test - bad gateway</a>) but as a newcomer to docker in general I don’t really understand what the equivalent is in my case.</p>
<p>I have tried the following:</p>
<ol>
<li>taking a local version and trying from there (no dice)</li>
<li>removing our LDAP layer (no dice)</li>
<li>pinging the sql server’s IP from each container locally and in dockerhost (this worked for all containers)</li>
<li>Tested the parameters I entered with pymssql in python 3 (this worked)</li>
</ol>
<p>This is the partially redacted docker-compose we are using, is there anything funky with it that anyone can see? Or is there anything obvious I’m missing?</p>
<pre><code>version: "2"
x-redash-service: &amp;redash-service
  build: .
  depends_on:
- postgres
- redis
  env_file: ./.env
services:
  server:
&lt;&lt;: *redash-service
command: server
ports:
  - "5000:5000"
environment:
  - REDASH_WEB_WORKERS=2
  - REDASH_LDAP_LOGIN_ENABLED=true
  - REDASH_LDAP_URL=REDACTED
  - REDASH_LDAP_BIND_DN=CN=LDAP_Redash,OU=Service Accounts,DC=REDACT,DC=NET
  - REDASH_LDAP_BIND_DN_PASSWORD=REDACTED
  - REDASH_LDAP_SEARCH_DN=OU=Sites,DC=REDACTED,DC=NET
  - REDASH_LDAP_SEARCH_TEMPLATE=(sAMAccountName=%(username)s)
  - REDASH_LDAP_DISPLAY_NAME_KEY=cn
  - REDASH_PASSWORD_LOGIN_ENABLED=false
  scheduler:
&lt;&lt;: *redash-service
command: scheduler
  worker:
&lt;&lt;: *redash-service
command: worker
environment:
  - QUEUES="periodic emails default"
  - WORKERS_COUNT=1
  query_worker:
&lt;&lt;: *redash-service
command: worker
environment:
  - QUEUES="scheduled_queries schema queries"
  - WORKERS_COUNT=1
  redis:
image: redis:5.0-alpine
restart: always
  postgres:
image: postgres:9.6-alpine
environment:
  - POSTGRES_HOST_AUTH_METHOD=trust
volumes:
  - /data/redash/postgres:/var/lib/postgresql/data
restart: always
  nginx:
image: redash/nginx:latest
ports:
  - "8901:80"
depends_on:
  - server
links:
  - server:redash
restart: always
</code></pre>
<p>Thanks!</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/k4s1m.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/k4s1m_avatar.png" tabindex="-1" width="48"/><span itemprop="name">k4s1m</span></a>
</span>
<link href="https://discuss.redash.io/t/500-response-and-timeout-of-worker-when-testing-connection/7874" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-01-22T16:26:31Z" itemprop="datePublished">
                    January 22, 2021,  4:26pm
                  </time>
<meta content="2021-01-22T16:26:31Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-post="1" data-topic="7874" data-username="chiliconcatne">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="https://avatars.discourse-cdn.com/v4/letter/c/c4cdca/40.png" width="20"/> chiliconcatne:</div>
<blockquote>
<ol start="4">
<li>Tested the parameters I entered with pymssql in python 3 (this worked)</li>
</ol>
</blockquote>
</aside>
<p>Did you do this from within one of the Docker containers?</p>
<p>I know you mentioned that you can ping the database server from within a container. But that doesn’t necessarily mean that database traffic can pass through the firewall because <code>ping</code> and <code>myssql</code> run on different ports.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/chiliconcatne.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/chiliconcatne_avatar.png" tabindex="-1" width="48"/><span itemprop="name">chiliconcatne</span></a>
</span>
<link href="https://discuss.redash.io/t/500-response-and-timeout-of-worker-when-testing-connection/7874" itemprop="mainEntityOfPage"/>
<link href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/2X/8/80c190562648261f10b0d34e69cc16d17e19fe77.png" itemprop="image"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-01-22T16:58:04Z" itemprop="datePublished">
                    January 22, 2021,  4:58pm
                  </time>
<meta content="2021-01-22T16:58:04Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi! Thanks for the response.</p>
<p>I did not do that initially, no, I have since your message tried running a python script using pymssql from within redash_server_1 container, fetching 1 row from the database I’m trying to connect, this has worked:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" data-download-href="/uploads/short-url/in1P8rzCh7hbHIelwjakFu4xan5.png?dl=1" href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/2X/8/80c190562648261f10b0d34e69cc16d17e19fe77.png" rel="noopener nofollow ugc" title="image"><img alt="image" data-base62-sha1="in1P8rzCh7hbHIelwjakFu4xan5" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/2X/8/80c190562648261f10b0d34e69cc16d17e19fe77_2_10x10.png" height="37" src="assets/80c190562648261f10b0d34e69cc16d17e19fe77.png" width="689"/><div class="meta">
<svg aria-hidden="true" class="fa d-icon d-icon-far-image svg-icon"><use href="#far-image"></use></svg><span class="filename">image</span><span class="informations">1279×70 6.42 KB</span><svg aria-hidden="true" class="fa d-icon d-icon-discourse-expand svg-icon"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Since the error originated from server_1 I wasnt sure if this was the best place to do it from, should I try the others? Is Nginx causing a complication here?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/chiliconcatne.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/chiliconcatne_avatar.png" tabindex="-1" width="48"/><span itemprop="name">chiliconcatne</span></a>
</span>
<link href="https://discuss.redash.io/t/500-response-and-timeout-of-worker-when-testing-connection/7874" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-01-22T17:11:15Z" itemprop="datePublished">
                    January 22, 2021,  5:11pm
                  </time>
<meta content="2021-01-22T17:11:15Z" itemprop="dateModified"/>
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>I can confirm this is also the case for the worker and query_worker containers in the docker-compose above</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/chiliconcatne.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/chiliconcatne_avatar.png" tabindex="-1" width="48"/><span itemprop="name">chiliconcatne</span></a>
</span>
<link href="https://discuss.redash.io/t/500-response-and-timeout-of-worker-when-testing-connection/7874" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-02-03T13:47:57Z" itemprop="datePublished">
                    February 3, 2021,  1:47pm
                  </time>
<meta content="2021-02-03T13:47:57Z" itemprop="dateModified"/>
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Wasnt able to find the solution to this, but remade the redash instance from scratch starting from v8. I figure it was due to whoever set up our instance not force recreating the image, so it was using v8 image with a v9 docker-compose. Would recommend that anyone experiencing this should remake their v8 instance, then retry the upgrade steps with backups at each step</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>