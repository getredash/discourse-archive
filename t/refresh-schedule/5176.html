<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>Refresh Scheduleを設定しても自動実行されない</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/refresh-schedule/5176">Refresh Scheduleを設定しても自動実行されない</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/japanese/12.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Japanese</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="Refresh Scheduleを設定しても自動実行されない" itemprop="headline"/>
<meta content="Japanese" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-13T03:32:42Z" itemprop="datePublished">
                    December 13, 2019,  3:32am
                  </time>
<meta content="2019-12-13T03:32:42Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>はじめまして。<br/>
redashについて調べていたところこちらを見つけ、もしかしたらと思い投稿させていただきます。<br/>
現在、社内のデータ把握の為に、redashを使用しています。<br/>
・OS：Ubuntu 16.04.4<br/>
・redash：4.0.1<br/>
aws amiをベースにec2上でインスタンス起動したものをずっと使用。</p>
<p>使用開始当初から、実は動いていなかったようなのですが、あるクエリに対し、<br/>
refresh schedule<br/>
を設定しても、自動実行されていないようなのです。<br/>
※Last Executedを見ても実行日時はかわらず、データも変更されない</p>
<p>これまで結局誰かが画面から更新をかけていた為、気づかなかったのですが…<br/>
自動実行を有効化するには何らか対応が必要なのか、動いていない原因の調査方法などご存じの方がいらっしゃいましたらお知恵をお借りできないでしょうか？</p>
<p>サーバ構築時はamiを使い.envのパラメータを一部調整したくらいしか実施していないと聞いております。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
<div class="crawler-linkback-list" itemscope="" itemtype="http://schema.org/ItemList">
<div itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a href="https://discuss.redash.io/t/scheduled-query-does-not-executed/10574" itemprop="url">Scheduled-query does not executed</a>
<meta content="1" itemprop="position"/>
</div>
<div itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a href="https://discuss.redash.io/t/scheduled-query/10509" itemprop="url">Scheduled-queryが実行されない</a>
<meta content="2" itemprop="position"/>
</div>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/zonneplan.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/zonneplan_avatar.png" tabindex="-1" width="48"/><span itemprop="name">zonneplan</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-13T09:23:46Z" itemprop="datePublished">
                    December 13, 2019,  9:23am
                  </time>
<meta content="2019-12-13T09:23:46Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>私の方もお会いできてうれしいです、</p>
<p>リフレッシュはどこでスケジュールしましたか？ ダッシュボードページ（右上のドロップダウン）またはクエリページ（左下の「更新スケジュール」）にありますか？</p>
<p>ゾンネプランに関して</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-13T10:59:30Z" itemprop="datePublished">
                    December 13, 2019, 10:59am
                  </time>
<meta content="2019-12-13T10:59:30Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="/u/tosawada">@tosawada</a> こんにちは！</p>
<p>自動実行ですが、私の知る範囲のバージョンでは、特別な設定が必要ということはなかったように思います。</p>
<p>考えられるのは、自動実行のキューを処理するワーカーが何らかの理由で動いていないなどの原因なのですが、お使いの環境では docker-compose で Redash を起動していますか？それとも supervisord(Legacy 構成)で起動しているでしょうか？</p>
<p>また、認証情報などが含まれないような形で、.env の内容を投稿していただけると、より解決につながるかもしれません。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-16T01:41:36Z" itemprop="datePublished">
                    December 16, 2019,  1:41am
                  </time>
<meta content="2019-12-16T01:41:36Z" itemprop="dateModified"/>
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>返信有難うございます。<br/>
スケジュールの設定はクエリの方で設定しています。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-16T02:02:31Z" itemprop="datePublished">
                    December 16, 2019,  2:02am
                  </time>
<meta content="2019-12-16T02:02:31Z" itemprop="dateModified"/>
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>返信有難うございます。</p>
<p>＞環境では docker-compose で Redash を起動していますか？<br/>
＞それとも supervisord(Legacy 構成)で起動しているでしょうか？</p>
<p>supervisordでの起動です。</p>
<p>＞env の内容<br/>
以下のような内容です。</p>
<p>export REDASH_LOG_LEVEL=“INFO”<br/>
export REDASH_REDIS_URL=redis://localhost:6379/0<br/>
export REDASH_DATABASE_URL=“postgresql:///redash”<br/>
export REDASH_COOKIE_SECRET=xxxxxx<br/>
export ORACLE_HOME=/opt/oracle/instantclient<br/>
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/oracle/instantclient<br/>
export PATH=$PATH:$ORACLE_HOME/bin<br/>
export NLS_LANG=JAPANESE_JAPAN.AL32UTF8<br/>
export NLS_DATE_FORMAT=YYYY-MM-DD<br/>
export REDASH_CSV_WRITER_ENCODING=“cp932”<br/>
export QUERY_RESULTS_CLEANUP_ENABLED=true<br/>
export QUERY_RESULTS_CLEANUP_COUNT=500<br/>
export QUERY_RESULTS_CLEANUP_MAX_AGE=1<br/>
export REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.python,redash.query_runner.oracle<br/>
export REDASH_FEATURE_DISABLE_REFRESH_QUERIES=false<br/>
export REDASH_ADHOC_QUERY_TIME_LIMIT=3600</p>
<p>導入環境が社内サーバ関連のnw内で構築しており、基本外部サイトへの参照等は全てブロックしていて参照出来ない点が原因では？<br/>
という話も出ましたが、、なんとも判断できず。。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_6" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-17T09:21:45Z" itemprop="datePublished">
                    December 17, 2019,  9:21am
                  </time>
<meta content="2019-12-17T09:21:45Z" itemprop="dateModified"/>
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="/u/tosawada">@tosawada</a> 情報ありがとうございます。</p>
<p>Redash が動作しているサーバーで <code>ps aux</code> を実行した際、以下のようなプロセスは確認できますか？<br/>
Celery に <code>-Qscheduled_queries</code> というオプションが付いたプロセスが、スケジュール実行を担うワーカーのプロセスになりますので、そのプロセスの有無でもう少し切り分けできるかと思います。</p>
<pre><code class="lang-auto">redash   25894  1.4  3.3 404520 133620 ?       S    09:16   0:01  \_ [celeryd: celery@ubuntu-bionic:MainProcess] -active- (worker --app=redash.worker -c2 -Qscheduled_queries --maxtasksperchild=10 -Ofair)
redash   25937  0.3  3.2 422776 133184 ?       S    09:16   0:00      \_ [celeryd: celery@ubuntu-bionic:Worker-1]
redash   25939  0.3  3.2 422784 133180 ?       S    09:16   0:00      \_ [celeryd: celery@ubuntu-bionic:Worker-2]
</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_7" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-18T04:07:19Z" itemprop="datePublished">
                    December 18, 2019,  4:07am
                  </time>
<meta content="2019-12-18T04:07:19Z" itemprop="dateModified"/>
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="/u/ariarijp">@ariarijp</a> プロセスの情報ですが、celery関連だと以下のようなプロセスがありました。<br/>
Qscheduled_queriesというものもあるように見えました。</p>
<pre><code>redash   10739  0.0  0.0 244120  1684 ?        S     5月08   0:00 [celeryd: celery@ntc-redash01:Worker-2]
redash   10740  0.0  0.0 244124  1680 ?        S     5月08   0:00 [celeryd: celery@ntc-redash01:Worker-3]
redash   18449  0.1  1.4 299368 114700 ?       S    12月16   1:53 [celeryd: celery@ntc-redash01:MainProcess] -active- (worker --app=redash.worker -c2 -Qscheduled_queries --maxtasksperchild=10 -Ofair)
redash   18498  0.0  1.4 317088 119876 ?       S    12月16   0:00 [celeryd: celery@ntc-redash01:Worker-1]
redash   18512  0.0  1.4 317088 119912 ?       S    12月16   0:00 [celeryd: celery@ntc-redash01:Worker-2]
redash   18518  0.1  1.4 300912 117540 ?       S    12月16   2:12 [celeryd: celery@ntc-redash01:MainProcess] -active- (worker --app=redash.worker --beat -c2 -Qqueries,celery --maxtasksperchild=10 -Ofair)</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_8" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-18T14:55:09Z" itemprop="datePublished">
                    December 18, 2019,  2:55pm
                  </time>
<meta content="2019-12-18T14:55:09Z" itemprop="dateModified"/>
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>プロセスが起動していないというわけではなさそうですね。<br/>
ログファイルに何か原因を表すような形跡はありませんか？</p>
<p>以下は私の手元で4.0.1をLegacy構成で立ち上げた際に書き出されているログの置き場所です。</p>
<pre><code class="lang-auto">vagrant@ubuntu-bionic:/var/log/supervisor$ ll redash_celery_scheduled-std*
-rw------- 1 root root 951 Dec 18 14:51 redash_celery_scheduled-stderr---supervisor-V9saiX.log
-rw------- 1 root root   0 Dec 18 14:51 redash_celery_scheduled-stdout---supervisor-Qs_FYM.log
</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_9" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-12-20T04:30:49Z" itemprop="datePublished">
                    December 20, 2019,  4:30am
                  </time>
<meta content="2019-12-20T04:30:49Z" itemprop="dateModified"/>
<span itemprop="position">9</span>
</span>
</div>
<div class="post" itemprop="text">
<p>ありがとうございます。<br/>
直近のログだと以下のようなものがありました。<br/>
ただ常に出ているわけではなく、プロセス再起動等のタイミング？で出ているように見え、関係があるかは判断できずですが…</p>
<p>※redash_celery_scheduled-stderr—supervisor-2uL7SB.log</p>
<pre><code>[2019-12-16 21:29:14,334][PID:18449][WARNING][MainProcess] /usr/local/lib/python2.7/dist-packages/celery/apps/worker.py:161: CDeprecationWarning: 
Starting from version 3.2 Celery will refuse to accept pickle by default.

The pickle serializer is a security concern as it may give attackers
the ability to execute any command.  It's important to secure
your broker from unauthorized access when using pickle, so we think
that enabling pickle should require a deliberate action and not be
the default choice.

If you depend on pickle then you should set a setting to disable this
warning and to be sure that everything will continue working
when you upgrade to Celery 3.2::

    CELERY_ACCEPT_CONTENT = ['pickle', 'json', 'msgpack', 'yaml']

You must only enable the serializers that you will actually use.

  warnings.warn(CDeprecationWarning(W_PICKLE_DEPRECATED))
[2019-12-16 21:29:16,466][PID:18449][WARNING][MainProcess] celery@ntc-redash01 ready.
</code></pre>
<p>※redash_celery_scheduled-stdout—supe rvisor-a_KJ_b.log</p>
<pre><code> -------------- celery@ntc-redash01 v3.1.25 (Cipater)
---- **** ----- 
--- * ***  * -- Linux-4.4.0-1061-aws-x86_64-with-Ubuntu-16.04-xenial
-- * - **** --- 
- ** ---------- [config]
- ** ---------- .&gt; app:         redash:0x7fa886cce590
- ** ---------- .&gt; transport:   redis://localhost:6379/0
- ** ---------- .&gt; results:     redis://localhost:6379/0
- *** --- * --- .&gt; concurrency: 2 (prefork)
-- ******* ---- 
--- ***** ----- [queues]
 -------------- .&gt; scheduled_queries exchange=scheduled_queries(direct) key=scheduled_queries
</code></pre>
<p>ちなみに、自動実行の機能がもし有効に動いた場合、<br/>
例えばEvery 1 minuteに設定し状態でクエリを保存しておくと、<br/>
・ブラウザからredashにアクセスし、該当queryを開くと１分前の実行結果が表示<br/>
・右下の再生マーク(実行用マーク)の左の直近の実行日の情報も１分前とわかるような表示になる<br/>
と思っているのですが(現状はそうなっていない)あっているでしょうか？</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_10" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-06T14:20:15Z" itemprop="datePublished">
                    January 6, 2020,  2:20pm
                  </time>
<meta content="2020-01-06T14:20:15Z" itemprop="dateModified"/>
<span itemprop="position">10</span>
</span>
</div>
<div class="post" itemprop="text">
<blockquote>
<p>直近のログだと以下のようなものがありました。<br/>
ただ常に出ているわけではなく、プロセス再起動等のタイミング？で出ているように見え、関係があるかは判断できずですが…</p>
</blockquote>
<p>以前教えていただいた環境変数のとおりであれば、ログレベルは INFO なのでもうちょっと何か出ていてほしいですね。。<br/>
ログレベルを DEBUG にすると、流れているクエリもログに吐かれるようになるのですが、こちらはすでに確認されていますか？</p>
<blockquote>
<p>ちなみに、自動実行の機能がもし有効に動いた場合、<br/>
例えばEvery 1 minuteに設定し状態でクエリを保存しておくと、<br/>
・ブラウザからredashにアクセスし、該当queryを開くと１分前の実行結果が表示<br/>
・右下の再生マーク(実行用マーク)の左の直近の実行日の情報も１分前とわかるような表示になる<br/>
と思っているのですが(現状はそうなっていない)あっているでしょうか？</p>
</blockquote>
<p>こちらはご認識のとおりです。</p>
<p>また、EC2 を利用されているということなのですが、インスタンスタイプはどちらになりますか？</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_11" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-08T03:09:17Z" itemprop="datePublished">
                    January 8, 2020,  3:09am
                  </time>
<meta content="2020-01-08T03:09:17Z" itemprop="dateModified"/>
<span itemprop="position">11</span>
</span>
</div>
<div class="post" itemprop="text">
<blockquote>
<p>ログレベルを DEBUG にすると、流れているクエリもログに吐かれるようになる<br/>
のですが、こちらはすでに確認されていますか？</p>
</blockquote>
<p>DEBUGに変更し、サービス再起動してみましたが、”redash_celery_scheduled-stderr…”には</p>
<p>” [2020-01-08 11:20:33,855][PID:20401][DEBUG][redash.query_runner] Registering Oracle (oracle) query runner.”</p>
<p>のような各データソース用の設定がされたようなログが増えたのみにで、起動後にlog更新が入りませんね。。（stdoutの方も）</p>
<blockquote>
<p>EC2 を利用されているということなのですが、インスタンスタイプは<br/>
どちらになりますか？</p>
</blockquote>
<p>t2 largeです。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_12" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-14T14:33:24Z" itemprop="datePublished">
                    January 14, 2020,  2:33pm
                  </time>
<meta content="2020-01-14T14:33:24Z" itemprop="dateModified"/>
<span itemprop="position">12</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="/u/tosawada">@tosawada</a> あらためて v4.0.1 の環境を作りなおし、検証してみたのですが。<br/>
クエリパラメータを使用したクエリの場合に自動実行されないことを確認しました。<br/>
クエリ自体をここで共有していただくことは難しいと思いますので、クエリパラメータを使っているか、確認してみてください。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_13" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-15T05:23:21Z" itemprop="datePublished">
                    January 15, 2020,  5:23am
                  </time>
<meta content="2020-01-15T05:23:21Z" itemprop="dateModified"/>
<span itemprop="position">13</span>
</span>
</div>
<div class="post" itemprop="text">
<p>わざわざ環境作成までありがとうございます。<br/>
クエリですが、今回はredashのクエリ一覧を定期的に最新に、というつもりで、以下クエリで設定してみていました。パラメータは使用していないです。</p>
<pre><code>select
queries.id,
queries.is_draft, queries.NAME, users.email, queries.query
  from queries, users
where queries.is_archived=false 
  AND queries.user_id = users.id
 orDER BY 2</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_14" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/ariarijp.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/ariarijp_avatar.png" tabindex="-1" width="48"/><span itemprop="name">ariarijp</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-15T15:04:37Z" itemprop="datePublished">
                    January 15, 2020,  3:04pm
                  </time>
<meta content="2020-01-15T15:04:37Z" itemprop="dateModified"/>
<span itemprop="position">14</span>
</span>
</div>
<div class="post" itemprop="text">
<p>クエリの確認・共有ありがとうございます。</p>
<p>頂いた SQL と同じものを毎分実行にして確認してみたのですが、私の環境では自動実行されていることが確認できました。</p>
<blockquote>
<p>導入環境が社内サーバ関連のnw内で構築しており、基本外部サイトへの参照等は全てブロックしていて参照出来ない点が原因では？</p>
</blockquote>
<p>念のためこちらも確認してみようと、ネットワークにつながらない状態にして確認しましたが、自動実行には影響ありませんでした。</p>
<p>現時点では解決にいたりませんでしたが、また何か気づいたことがあれば共有させていただきますね。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_15" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/tosawada.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/tosawada_avatar.png" tabindex="-1" width="48"/><span itemprop="name">tosawada</span></a>
</span>
<link href="https://discuss.redash.io/t/refresh-schedule/5176" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-16T06:13:55Z" itemprop="datePublished">
                    January 16, 2020,  6:13am
                  </time>
<meta content="2020-01-16T06:13:55Z" itemprop="dateModified"/>
<span itemprop="position">15</span>
</span>
</div>
<div class="post" itemprop="text">
<p>諸々ありがとうございます。<br/>
こちら引き続き確認はする予定ですが、何か進展がありましたらまた共有させていただきます。</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>