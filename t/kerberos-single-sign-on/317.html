<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>Kerberos Single Sign-on</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/kerberos-single-sign-on/317">Kerberos Single Sign-on</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/development/7.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Development</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="Kerberos Single Sign-on" itemprop="headline"/>
<meta content="Development" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/steamraven.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/steamraven_avatar.png" tabindex="-1" width="48"/><span itemprop="name">steamraven</span></a>
</span>
<link href="https://discuss.redash.io/t/kerberos-single-sign-on/317" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2016-12-07T15:05:34Z" itemprop="datePublished">
                    December 7, 2016,  3:05pm
                  </time>
<meta content="2016-12-07T15:05:34Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>I just got  Re:Dash working with Kerberos Single Sign-on in an Active Directory Environment and wanted to share my results.</p>
<p>This makes use of the fairly undocumented feature in re:Dash:  REMOTE_USER_LOGIN_ENABLED.  With this enabled, Re:dash trusts a proxy to send a valid and pre-authenticated username as a header.</p>
<p>Since I wanted to use kerberos, I opted to switch out nginx with apache.   Apache is not as optimal an nginx, however they do provide the module I needed: mod_auth_kerb.</p>
<p>The biggest problem with mod_auth_kerb is that the usernames are suffixed with the Kerberos realm and thus may not be valid emails.  They were not for us.   The solution was to use an option to strip the realm and manually append our domain after the username.  This works because our usernames and mailboxes use the same name.  Other setups may be different.</p>
<p>Kerberos setup can be a real pain to setup.  I used Centrify DirectControl to help.  With this, I can join my linux box to the windows domain and it automatically sets up the kerberos config file: /etc/krb5.conf and populates the keytab: /etc/krb5.keytab.  No having to mess around with ktpass on the domain controller and manually adding spn’s.  This can be done manually and there are several how-tos out there.</p>
<p>#<span class="hashtag">#Steps:</span></p>
<ol>
<li>Remove or disable nginx</li>
<li>Install apache with mod_auth_kerb</li>
<li>Install Centrify DirectControl.</li>
<li>Change permisions on /etc/krb5.keytab so that it is readable by apache user</li>
<li>Configure Apache (see configuration below)
<ol>
<li>mod_auth_kerb to point to system keytab: /etc/krb5.keytab</li>
<li>Configure apache as a proxy</li>
<li>Configure the /remote_user/login url to require and forward a valid credential</li>
</ol>
</li>
<li>Configure re:dash to use remote_user login (do not disable password login yet)</li>
<li>Login using the “remote user” link on the main login page to create the user</li>
<li>Using the admin login, grant the newly created account admin privilege</li>
<li>Disable password login in re:dash</li>
</ol>
<p>#<span class="hashtag">#My</span> configuration files:<br/>
###<span class="hashtag">#Apache</span> configuration:</p>
<pre><code>&lt;VirtualHost *:80&gt;
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        # Setup proxy
        ProxyPass "/" "http://127.0.0.1:5000/"
        ProxyPassReverse "/" "http://127.0.0.1:5000/"
        ProxyPreserveHost On

        # Extra Headers for re:Dash
        RequestHeader set X-Real-IP expr=%{REMOTE_ADDR}

        # Add domain name to create an email from a username 
        RequestHeader set X-Forwarded-Remote-User expr=%{REMOTE_USER}@mydomain.org

        # logging. Very useful for debugging kerberos errors
        #LogLevel debug

        # Require kerberos just for the remote_user login
        # Other pages protected by auth cookie set by re:dash
        &lt;ProxyMatch https?://[^/]+/remote_user/login&gt;
                AuthType Kerberos
                KrbMethodNegotiate on
                KrbMethodK5Passwd Off

                # Strip kerberos realm from login name
                KrbLocalUserMapping on

                # This is needed for Centrify as mod_auth_kerb defaults to HTTP
                KrbServiceName http

                Require valid-user
        &lt;/ProxyMatch&gt;

 &lt;/VirtualHost&gt;
</code></pre>
<h4>Redash .env</h4>
<pre><code>export REDASH_REMOTE_USER_LOGIN_ENABLED=true
# only disable after you have granted Admin rights to a domain user
# export REDASH_PASSWORD_LOGIN_ENABLED=false
</code></pre>
<p>If you have any questions, I would be happy to answer them</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>