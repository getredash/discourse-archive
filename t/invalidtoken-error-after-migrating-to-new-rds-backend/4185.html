<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>InvalidToken error after migrating to new rds backend</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185">InvalidToken error after migrating to new rds backend</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/6.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Support</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/support-self-hosted/9.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Self Hosted Redash Support</span>
</span>
</a>
<meta content="2" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="InvalidToken error after migrating to new rds backend" itemprop="headline"/>
<meta content="Self Hosted Redash Support" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/kannan-ak.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/kannan-ak_avatar.png" tabindex="-1" width="48"/><span itemprop="name">kannan-ak</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-16T13:07:55Z" itemprop="datePublished">
                    July 16, 2019,  1:07pm
                  </time>
<meta content="2019-07-16T13:17:34Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<h3>
<a class="anchor" href="#issue-summary-1" name="issue-summary-1"></a>Issue Summary</h3>
<p>We’re using self hosted redash legacy setup. We upgraded it to version 7 couple of months back.</p>
<p>Right now, I’m trying to move the backend to dedicated rds.</p>
<p>I stopped all the services, took a pgdump. Then I loaded the pgdump to rds pgsql instance.</p>
<p>Then I created a new redash instance (for POC) using docker based ami. Updated the env details to point to the new RDS, started the services. I am able to login to the redash but can’t see the data sources.</p>
<p>Upon checking the docker logs, I see that ‘InvalidToken’ error appears for accessing the data sources.</p>
<pre><code>[2019-07-16 12:40:51,896][PID:14][ERROR][redash] Exception on /api/data_sources [GET]
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1639, in full_dispatch_request
rv = self.dispatch_request()
  File "/usr/local/lib/python2.7/dist-packages/flask/app.py", line 1625, in dispatch_request
return self.view_functions[rule.endpoint](**req.view_args)
  File "/usr/local/lib/python2.7/dist-packages/flask_restful/__init__.py", line 477, in wrapper
resp = resource(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/flask_login/utils.py", line 228, in decorated_view
return func(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/flask/views.py", line 84, in view
return self.dispatch_request(*args, **kwargs)
  File "/app/redash/handlers/base.py", line 31, in dispatch_request
return super(BaseResource, self).dispatch_request(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/flask_restful/__init__.py", line 587, in dispatch_request
resp = meth(*args, **kwargs)
  File "/app/redash/permissions.py", line 48, in decorated
return fn(*args, **kwargs)
  File "/app/redash/handlers/data_sources.py", line 88, in get
for ds in data_sources:
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/loading.py", line 98, in instances
util.raise_from_cause(err)
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/util/compat.py", line 265, in raise_from_cause
reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/loading.py", line 79, in instances
rows = [proc(row) for row in fetch]
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/loading.py", line 511, in _instance
loaded_instance, populate_existing, populators)
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/orm/loading.py", line 611, in _populate_full
dict_[key] = getter(row)
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy/sql/type_api.py", line 1226, in process
return process_value(impl_processor(value), dialect)
  File "/app/redash/models/types.py", line 28, in process_result_value
return ConfigurationContainer.from_json(super(EncryptedConfiguration, self).process_result_value(value, dialect))
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy_utils/types/encrypted/encrypted_type.py", line 409, in process_result_value
decrypted_value = self.engine.decrypt(value)
  File "/usr/local/lib/python2.7/dist-packages/sqlalchemy_utils/types/encrypted/encrypted_type.py", line 216, in decrypt
decrypted = self.fernet.decrypt(value)
  File "/usr/local/lib/python2.7/dist-packages/cryptography/fernet.py", line 103, in decrypt
raise InvalidToken
InvalidToken
</code></pre>
<p>I went through the forum, github issues and understood that this is due to data sources configuration encryption in the redash version 7.</p>
<p>REDASH_COOKIE_SECRET is already configured in the existing instance. So I tried using the same<br/>
key details in the new instance, restarted the container, but still getting the same invalid token error.</p>
<p>I’ve spent time in redash forums from morning to an extent that I’ve been promoted to ‘trust level’ <img alt=":smiley:" class="emoji" src="assets/smiley.png" title=":smiley:"/></p>
<p>Most of the relevant issue topics are pre 7x version. The closest topic was <a class="inline-onebox" href="http://discuss.redash.io/t/upgrading-to-v7-invalid-token-error/3491">Upgrading to V7, Invalid token error</a> and checked the <a class="inline-onebox" href="https://github.com/getredash/redash/issues/3617#issuecomment-477188592" rel="noopener nofollow ugc">Unable to connect to data sources after upgrading to version v7.0.0.b17489 · Issue #3617 · getredash/redash · GitHub</a>, but we already set the COOKIE_SECRET in the production instance and tried with the same in POC instance, still no luck. Looking for your inputs.</p>
<p>Further posts I referred for this migration:</p><aside class="quote quote-modified" data-post="1" data-topic="18">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" loading="lazy" src="https://avatars.discourse-cdn.com/v4/letter/t/96bed5/40.png" width="20"/>
<a href="http://discuss.redash.io/t/walkthrough-for-using-rds-as-a-backend/18">Walkthrough for using RDS as a backend</a> <a class="badge-wrapper bullet" href="/c/support/support-self-hosted/9"><span class="badge-category-parent-bg" style="background-color: #BF1E2E;"></span><span class="badge-category-bg" style="background-color: #AB9364;"></span><span class="badge-category clear-badge" data-drop-close="true" style="" title="Support on installing, configuring and troubleshooting issues with self hosted Redash.">Self Hosted Redash Support</span></a>
</div>
<blockquote>
    This is a support feature request <img alt="slight_smile" class="emoji" height="20" src="assets/slight_smile.png" title="slight_smile" width="20"/> The redash installation docs are very solid, and the fact that there are AMIs and a docker image makes it even easier. 
One common task that I think many people will want to do is set up the Redash metadata database as an RDS db instead of on localhost. I’m positive that if I sink some hours into this that I can figure out how to do it, but it would be great if a walkthrough for how to do this were just a part of the setup docs, because I’m sure m…
  </blockquote>
</aside>
<aside class="quote quote-modified" data-post="15" data-topic="2535">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" loading="lazy" src="https://avatars.discourse-cdn.com/v4/letter/h/d6d6ee/40.png" width="20"/>
<a href="http://discuss.redash.io/t/backing-up-all-data-on-my-own-hosted-redash/2535/15">Backing up all data on my own hosted redash</a> <a class="badge-wrapper bullet" href="/c/support/support-self-hosted/9"><span class="badge-category-parent-bg" style="background-color: #BF1E2E;"></span><span class="badge-category-bg" style="background-color: #AB9364;"></span><span class="badge-category clear-badge" data-drop-close="true" style="" title="Support on installing, configuring and troubleshooting issues with self hosted Redash.">Self Hosted Redash Support</span></a>
</div>
<blockquote>
    postgres_1          | ERROR:  column queries.tags does not exist at character 840 
postgres_1          | STATEMENT:  SELECT queries.query AS queries_query, queries.updated_at AS queries_updated_at, queries.created_at AS queries_created_at, queries.id AS queries_id, queries.version AS queries_version, queries.org_id AS queries_org_id, queries.data_source_id AS queries_data_source_id, queries.latest_query_data_id AS queries_latest_query_data_id, queries.name AS queries_name, queries.description AS…
  </blockquote>
</aside>
<h3>
<a class="anchor" href="#technical-details-2" name="technical-details-2"></a>Technical details:</h3>
<ul>
<li>Redash Version: 7</li>
<li>Browser/OS: firefox</li>
<li>How did you install Redash: docker ami</li>
</ul>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-16T13:27:36Z" itemprop="datePublished">
                    July 16, 2019,  1:27pm
                  </time>
<meta content="2019-07-16T13:27:36Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-post="1" data-topic="4185">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="assets/1078_2.png" width="20"/> kannan-ak:</div>
<blockquote>
<p>REDASH_COOKIE_SECRET is already configured in the existing instance. So I tried using the same<br/>
key details in the new instance, restarted the container, but still getting the same invalid token error.</p>
</blockquote>
</aside>
<p>Just to make sure:</p>
<ol>
<li>Are you sure the previous instance didn’t use the dedicated setting? (REDASH_SECRET_KEY)</li>
<li>Is the previous instance currently working?</li>
<li>How did you restart?</li>
</ol>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/kannan-ak.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/kannan-ak_avatar.png" tabindex="-1" width="48"/><span itemprop="name">kannan-ak</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-16T13:38:11Z" itemprop="datePublished">
                    July 16, 2019,  1:38pm
                  </time>
<meta content="2019-07-16T13:38:11Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi Arik,</p>
<p>Thank you for your prompt response.<br/>
<em>1. Are you sure the previous instance didn’t use the dedicated setting? (REDASH_SECRET_KEY)</em><br/>
Yes,  REDASH_SECRET_KEY is not used. The setup refers to .env file under /opt/redash/.env and only REDASH_COOKIE_SECRET is configured. Even the .env file under /opt/redash/redash.7.0.0.b17535 is symlinked to /opt/redash/.env, so I’m sure REDASH_SECRET_KEY is not used. Is there any other configs do I have to look into or any way to find whether the variable is used?</p>
<p><em>2. Is the previous instance currently working?</em><br/>
Yes. I didn’t make any changes in the instance. I stopped the services using ‘supervisorctl stop all’, took pgdump, then started the services. It is working as expected.</p>
<p><em>3. How did you restart?</em><br/>
After env file update, I restarted using ‘sudo docker-compose up -d’ .<br/>
Also I tried various options like ‘sudo docker-compose restart -t 1’, ‘sudo docker-compose down’ followed by ‘sudo docker-compose up -d’.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="2" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/kannan-ak.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/kannan-ak_avatar.png" tabindex="-1" width="48"/><span itemprop="name">kannan-ak</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-16T13:41:46Z" itemprop="datePublished">
                    July 16, 2019,  1:41pm
                  </time>
<meta content="2019-07-16T13:41:46Z" itemprop="dateModified"/>
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Also to add:<br/>
In the docker-compose.yml, the env_file is passed at the top,</p>
<pre><code>version: '2'
x-redash-service: &amp;redash-service
  image: redash/redash:latest
  depends_on:
          #    - postgres
    - redis
  env_file: /opt/redash/env
  restart: always
services:
</code></pre>
<p>Seeing your comment in one of the github issues, I just added REDASH_COOKIE_SECRET: “xxxxx”’ under environment section of each services, also added     env_file: /opt/redash/env under redis section. Still no luck.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-16T13:57:28Z" itemprop="datePublished">
                    July 16, 2019,  1:57pm
                  </time>
<meta content="2019-07-16T13:57:28Z" itemprop="dateModified"/>
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p><s>It seems like everything you’re doing is correct. Are you sure it uses the database you restored?</s></p>
<p><s>The old instances used a dedicated DB named <code>redash</code>, while the Docker ones just use <code>postgres</code>. Maybe the db was restored into <code>redash</code> while the code looks at <code>postgres</code>?</s></p>
<p>Nevermind: just noticed that you mentioned you’re using RDS <img alt=":thinking:" class="emoji" src="assets/thinking.png" title=":thinking:"/></p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_6" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/kannan-ak.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/kannan-ak_avatar.png" tabindex="-1" width="48"/><span itemprop="name">kannan-ak</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-17T06:35:38Z" itemprop="datePublished">
                    July 17, 2019,  6:35am
                  </time>
<meta content="2019-07-17T06:35:38Z" itemprop="dateModified"/>
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Hi Arik,</p>
<p>If I understand correctly, the data sources configuration are encrypted and not able to view it due to the invalid token error. This encryption will impact only the existing data sources. So wondering can I manually recreate the data sources exist in the production redash, here? If I do that, it should work seamlessly in POC instance right? I mean, will the invalid token affect anything else?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_7" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/kannan-ak.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/kannan-ak_avatar.png" tabindex="-1" width="48"/><span itemprop="name">kannan-ak</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-17T07:10:48Z" itemprop="datePublished">
                    July 17, 2019,  7:10am
                  </time>
<meta content="2019-07-17T07:10:48Z" itemprop="dateModified"/>
<span itemprop="position">7</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Ok, I created a new data source. But that data source also not visible after creation, because redash tries to access the data sources page again and getting internal server error.</p>
<pre><code>[2019-07-17 07:06:52,121][PID:14][ERROR][redash] Exception on /api/data_sources [GET]
..
..
 File "/usr/local/lib/python2.7/dist-packages/cryptography/fernet.py", line 103, in decrypt
    raise InvalidToken</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_8" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/invalidtoken-error-after-migrating-to-new-rds-backend/4185" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-07-18T14:55:12Z" itemprop="datePublished">
                    July 18, 2019,  2:55pm
                  </time>
<meta content="2019-07-18T14:55:12Z" itemprop="dateModified"/>
<span itemprop="position">8</span>
</span>
</div>
<div class="post" itemprop="text">
<p>You will need to delete the old data sources for things to work. But weren’t they used for anything already?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>