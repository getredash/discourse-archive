<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>Invalid token when configuring SAML</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/invalid-token-when-configuring-saml/6448">Invalid token when configuring SAML</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/6.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Support</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/support/support-self-hosted/9.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Self Hosted Redash Support</span>
</span>
</a>
<meta content="2" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="Invalid token when configuring SAML" itemprop="headline"/>
<meta content="Self Hosted Redash Support" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/pinocchio.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/pinocchio_avatar.png" tabindex="-1" width="48"/><span itemprop="name">pinocchio</span></a>
</span>
<link href="https://discuss.redash.io/t/invalid-token-when-configuring-saml/6448" itemprop="mainEntityOfPage"/>
<link href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/2X/f/fbe1796f4d4bfc81104743c70a5d539086a0336c.png" itemprop="image"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-06-12T17:22:02Z" itemprop="datePublished">
                    June 12, 2020,  5:22pm
                  </time>
<meta content="2020-06-12T17:22:02Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Folks, I need help to figure out what is going on with my  redash SAML configuration. We use google as our identity provider and since they don’t provide an endpoint to serve their metadata URL. I basically downloaded the IDP metadata and spun a link in my nginx container pointing to the file in my case index.xml. but i keep seeing a parse error “not well formed invalid token” in the logs when i try to sign in using SAML. Can anyone please help with what i might be doing wrong. I am running a V 8.0.0.b32245 on docker</p>
<p><img alt="image" data-base62-sha1="zWeV8RgadIM25nVWpaC0d3Fv5Ra" height="375" src="assets/fbe1796f4d4bfc81104743c70a5d539086a0336c.png" width="352"/></p>
<p><strong><img alt="" height="160" src="https://lh4.googleusercontent.com/cu5HNMuIsbtelPgLgll7I3pHMkRUjkhtCHCFUiIUhcV3QVA0AfcZwvJQcosH9bp0LriL4n99eT0GKRRmcdaqeAI4dLmFHaPk1Z7t_2q8C1whp2XrcuFg_OBl2J105B3lS2YY3Ylo" width="461"/></strong></p>
<p><strong><img alt="" height="63" src="https://lh4.googleusercontent.com/ogVhKbRKNnDUzFdmd5AOUS7jYT7Jqz0t3OIJsRGUefAnmGtfHjBpoY9Dw23hnlB7jJvoYTIs5p9_g1sP9WUTQXTYow2NvvU2VKFLrcReWuLfzNWgkI7EoGSDoZmvyp9iLCmXvjVd" width="624"/></strong></p>
<p>here are the server logs:</p>
<p>[2020-06-12 17:02:31,516][PID:12][DEBUG][saml2.httpbase] Response status: 200<br/>
[2020-06-12 17:02:31,518] ERROR in app: Exception on /saml/login [GET]<br/>
Traceback (most recent call last):<br/>
File “/usr/local/lib/python2.7/site-packages/flask/app.py”, line 1982, in wsgi_app<br/>
response = self.full_dispatch_request()<br/>
File “/usr/local/lib/python2.7/site-packages/flask/app.py”, line 1614, in full_dispatch_request<br/>
rv = self.handle_user_exception(e)<br/>
File “/usr/local/lib/python2.7/site-packages/flask_restful/<strong>init</strong>.py”, line 271, in error_router<br/>
return original_handler(e)<br/>
File “/usr/local/lib/python2.7/site-packages/flask/app.py”, line 1517, in handle_user_exception<br/>
reraise(exc_type, exc_value, tb)<br/>
File “/usr/local/lib/python2.7/site-packages/flask/app.py”, line 1612, in full_dispatch_request<br/>
rv = self.dispatch_request()<br/>
File “/usr/local/lib/python2.7/site-packages/flask/app.py”, line 1598, in dispatch_request<br/>
return self.view_functions<a>rule.endpoint</a><br/>
File “/app/redash/authentication/saml_auth.py”, line 106, in sp_initiated<br/>
saml_client = get_saml_client(current_org)<br/>
File “/app/redash/authentication/saml_auth.py”, line 56, in get_saml_client<br/>
sp_config.load(saml_settings)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/config.py”, line 356, in load<br/>
self.load_complex(cnf, metadata_construction=metadata_construction)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/config.py”, line 296, in load_complex<br/>
self.load_metadata(cnf[“metadata”]))<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/config.py”, line 400, in load_metadata<br/>
mds.imp(metadata_conf)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/mdstore.py”, line 922, in imp<br/>
self.load(key, **val)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/mdstore.py”, line 910, in load<br/>
_md.load()<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/mdstore.py”, line 754, in load<br/>
return self.parse_and_check_signature(_txt)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/mdstore.py”, line 635, in parse_and_check_signature<br/>
self.parse(txt)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/mdstore.py”, line 522, in parse<br/>
self.entities_descr = md.entities_descriptor_from_string(xmlstr)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/md.py”, line 1859, in entities_descriptor_from_string<br/>
return saml2.create_class_from_xml_string(EntitiesDescriptor, xml_string)<br/>
File “/usr/local/lib/python2.7/site-packages/saml2/<strong>init</strong>.py”, line 91, in create_class_from_xml_string<br/>
tree = defusedxml.ElementTree.fromstring(xml_string)<br/>
File “/usr/local/lib/python2.7/site-packages/defusedxml/common.py”, line 131, in fromstring<br/>
parser.feed(text)<br/>
File “/usr/local/lib/python2.7/xml/etree/ElementTree.py”, line 1659, in feed<br/>
self._raiseerror(v)<br/>
File “/usr/local/lib/python2.7/xml/etree/ElementTree.py”, line 1523, in _raiseerror<br/>
raise err<br/>
ParseError: not well-formed (invalid token): line 3, column 1</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/jesse.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/jesse_avatar.png" tabindex="-1" width="48"/><span itemprop="name">jesse</span></a>
</span>
<link href="https://discuss.redash.io/t/invalid-token-when-configuring-saml/6448" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-06-12T18:28:16Z" itemprop="datePublished">
                    June 12, 2020,  6:28pm
                  </time>
<meta content="2020-06-12T18:28:16Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Have you checked <code>index.xml</code> with an XML parser to see if it’s valid?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/pinocchio.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/pinocchio_avatar.png" tabindex="-1" width="48"/><span itemprop="name">pinocchio</span></a>
</span>
<link href="https://discuss.redash.io/t/invalid-token-when-configuring-saml/6448" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-06-12T19:23:25Z" itemprop="datePublished">
                    June 12, 2020,  7:23pm
                  </time>
<meta content="2020-06-12T19:23:25Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>thank you for that. that actually pointed to where my issue is which was white spaces in my xml file as a result of directly copying from my text editor.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>