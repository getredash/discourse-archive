<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Thoughts on adding support for queries with parameters in query results data source - Development - Redash Discourse</title>
    <meta name="description" content="Following @ariarijp pull request on changing the way we find query IDs in Query Results queries to later support queries with parameters, I wanted to start a discussion on how this might work and to share some thoughts I&amp;hellip;">
    <meta name="generator" content="Discourse 3.2.0.beta2-dev - https://github.com/discourse/discourse version 83621ccbe797223b48b624b00ef04f24672e1f03">
<link rel="icon" type="image/png" href="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/01e20869afc0877e3e5aee0f94419b9e9bffa961_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/e1838a8a0c506503a22e0c60e2334374b2895c87_2_180x180.png">
<meta name="theme-color" media="all" content="#ffffff">

<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709" />

<link rel="search" type="application/opensearchdescription+xml" href="https://discuss.redash.io/opensearch.xml" title="Redash Discourse Search">

    <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" class="light-scheme"/>

  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="desktop"  />



  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="checklist"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-adplugin"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-akismet"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-cakeday"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-chat-integration"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-footnote"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-lazy-videos"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-narrative-bot_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-presence_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-solved_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-solved"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/discourse-spoiler-alert_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="discourse-spoiler-alert"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/hosted-site_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="hosted-site"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/poll_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/poll_desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://sjc6.discourse-cdn.com/standard17/stylesheets/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css?__ws=discuss.redash.io" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-47088186-6" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

  <link rel="preload" href="https://global.discourse-cdn.com/standard17/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.gz.js" as="script">
<script defer src="https://global.discourse-cdn.com/standard17/assets/google-universal-analytics-v3-08add7ec997ab472fcd9f821d32ff7caf4b8b9a5de2ec18ca723a040be07a098.gz.js"></script>


        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Thoughts on adding support for queries with parameters in query results data source&#39;" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709.rss" />
    <meta property="og:site_name" content="Redash Discourse" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/e1838a8a0c506503a22e0c60e2334374b2895c87.png" />
<meta property="og:image" content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/e1838a8a0c506503a22e0c60e2334374b2895c87.png" />
<meta property="og:url" content="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709" />
<meta name="twitter:url" content="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709" />
<meta property="og:title" content="Thoughts on adding support for queries with parameters in query results data source" />
<meta name="twitter:title" content="Thoughts on adding support for queries with parameters in query results data source" />
<meta property="og:description" content="Following @ariarijp pull request on changing the way we find query IDs in Query Results queries to later support queries with parameters, I wanted to start a discussion on how this might work and to share some thoughts I had:  There are two use cases for querying from queries with parameters:  1.  The simple use case: you just want to use a query with parameters and you “know” what the values are:   We can detect that the query you’re querying from needs parameters and show the needed parameter ..." />
<meta name="twitter:description" content="Following @ariarijp pull request on changing the way we find query IDs in Query Results queries to later support queries with parameters, I wanted to start a discussion on how this might work and to share some thoughts I had:  There are two use cases for querying from queries with parameters:  1.  The simple use case: you just want to use a query with parameters and you “know” what the values are:   We can detect that the query you’re querying from needs parameters and show the needed parameter ..." />
<meta property="og:article:section" content="Development" />
<meta property="og:article:section:color" content="8C6238" />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="7 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="36 ❤" />
<meta property="article:published_time" content="2018-03-22T12:00:48+00:00" />
<meta property="og:ignore_canonical" content="true" />

        <link rel="next" href="/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709?page=2">

    
  </head>
  <body class="crawler ">
    
    <header>
  <a href="/">
    Redash Discourse
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">Thoughts on adding support for queries with parameters in query results data source</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://discuss.redash.io/c/development/7" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #8C6238'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Development</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  

    <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <meta itemprop='headline' content='Thoughts on adding support for queries with parameters in query results data source'>
        <meta itemprop='articleSection' content='Development'>
      <meta itemprop='keywords' content=''>
      <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
        <meta itemprop='name' content='Redash Discourse'>
          <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
            <meta itemprop='url' content='https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png'>
          </div>
      </div>

          <div id='post_1'  class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/arikfr'><span itemprop='name'>arikfr</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-03-22T12:00:48Z' class='post-time'>
                    March 22, 2018, 12:00pm
                  </time>
                  <meta itemprop='dateModified' content='2018-03-22T12:00:48Z'>
              <span itemprop='position'>1</span>
              </span>
            </div>
            <div class='post' itemprop='articleBody'>
              <p>Following <a class="mention" href="/u/ariarijp">@ariarijp</a> pull request on changing the way we find query IDs in <em>Query Results</em> queries to later support queries with parameters, I wanted to start a discussion on how this might work and to share some thoughts I had:</p>
<p>There are two use cases for querying from queries with parameters:</p>
<p>1.</p>
<p>The simple use case: you just want to use a query with parameters and you “know” what the values are:</p>
<ul>
<li>We can detect that the query you’re querying from needs parameters and show the needed parameter input fields and pass those values along when loading this query (will require adding the logic of detecting query IDs in client side code).</li>
<li>Allow for some syntax of passing parameters like <a class="mention" href="/u/ariarijp">@ariarijp</a> suggested (although I feel that using JSON is not very user friendly, although very pragmatic).</li>
</ul>
<p>2.</p>
<p>There is another more advanced use case: you want to pass returning values from one query into another. Here’s an example:</p>
<p>Datasource A has users list, datasource B has user events. You want to return list of active users in the past day along with their details. So you need to filter the users list in A based on ids from B.</p>
<p>So the query A on data source A might be:</p>
<pre><code class="lang-sql">SELECT name FROM users WHERE id IN ({{user_ids}});
</code></pre>
<p>The query B on B might be:</p>
<pre><code class="lang-auto">SELECT distinct user_id FROM events WHERE created_at &gt; '...';
</code></pre>
<p>And you want the results from query B to be merged into the the query A.</p>
<p>Maybe this doesn’t have to be implemented as part of query results feature, though? Maybe it can be some syntax like parameters:</p>
<pre><code class="lang-sql">SELECT name FROM users WHERE id IN ({% query_results 456 %});
</code></pre>
<p><code>query_results</code> is a function to load query results and we can have others to insert snippets and maybe other things?</p>
<hr>
<p>I hope the explanation makes sense. Of course we can implement use case 1 without implementing use case 2.</p>
<p>Any feedback or thoughts will be welcomed <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="3" />
              <span class='post-likes'>3 Likes</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://discuss.redash.io/t/parameters-on-querying-existing-query-results/1877/2">Parameters on Querying Existing Query Results</a>
                        <meta itemprop='position' content='1'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://discuss.redash.io/t/reql-query-language/1736/2">ReQL query language</a>
                        <meta itemprop='position' content='2'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://discuss.redash.io/t/query-query-result-cache-with-parameters/2545">Query Query-Result-Cache with parameters</a>
                        <meta itemprop='position' content='3'>
                      </div>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://discuss.redash.io/t/related-parameters-are-not-working/5993/4">Related parameters are not working</a>
                        <meta itemprop='position' content='4'>
                      </div>
                </div>
          </div>
          <div id='post_2' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-03-22T14:03:26Z' class='post-time'>
                    March 22, 2018,  2:03pm
                  </time>
                  <meta itemprop='dateModified' content='2018-03-22T14:03:26Z'>
              <span itemprop='position'>2</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi, Arik</p>
<p>Thank you for sharing your thoughts.<br>
I can make sense about these use cases.</p>
<p>For now, I would like to talk about your “use case 1”.</p>
<p>First, here is PoC of my thoughts.</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://github.githubassets.com/favicons/favicon.svg" class="site-icon" width="32" height="32">
      <a href="https://github.com/getredash/redash/compare/master...ariarijp:poc-query-results-with-params" target="_blank" rel="nofollow noopener">GitHub</a>
  </header>
  <article class="onebox-body">
    <img src="https://avatars1.githubusercontent.com/u/10746780?s=400&amp;v=4" class="thumbnail onebox-avatar" width="310" height="310">

<h3><a href="https://github.com/getredash/redash/compare/master...ariarijp:poc-query-results-with-params" target="_blank" rel="nofollow noopener">getredash/redash</a></h3>

<p>Make Your Company Data Driven. Connect to any data source, easily visualize, dashboard and share your data. - getredash/redash</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>For example,</p>
<p>Query 1</p>
<pre><code class="lang-auto">SELECT * FROM film WHERE rating = '{{ rating }}'
</code></pre>
<p>Query 2</p>
<pre><code class="lang-auto">SELECT * FROM query_1('{"rating": "PG-13"}')
</code></pre>
<p>I prefer to use JSON as parameter.<br>
The reason why JSON is very common format for developers and easy to understand.</p>
<p>I agree JSON is not friendly for some users.<br>
However, I think SQL is very pragmatic and not friendly for non-technical users such as marketer, biz-dev and so on.</p>
<p>I think Query Results is advanced feature on Redash.<br>
I guess this feature wanted by techinical guys, they don’t require any code completion.<br>
(Of course, I want to use this feature with code completion <img src="https://emoji.discourse-cdn.com/twitter/grinning.png?v=9" title=":grinning:" class="emoji" alt=":grinning:">)</p>
<p>Please feel free to ask me about it and any feedback is welcome.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_3' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-07-31T03:03:43Z' class='post-time'>
                    July 31, 2018,  3:03am
                  </time>
                  <meta itemprop='dateModified' content='2018-07-31T03:03:43Z'>
              <span itemprop='position'>3</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi there, and thank you for such a great tool!<br>
I think that I’m trying to do what is described here, in the simple use case (1). I have the “Active Users” query from GA with global parameters, like this one:</p>
<pre><code class="lang-auto">{
  "ids": "ga:xxxxxxxxx",
  "start_date": "{{Start Date}}",
  "end_date": "{{End Date}}",
  "metrics": "ga:users"
}
</code></pre>
<p>And I also have the “Total Users” number from our PostgreSQL database. Then I want to have the dashboard widget that displays Total / Active users numbers somehow like that:</p>
<pre><code class="lang-auto">select total.users || ' / ' || active.ga_users as 'Total / Active'
from query_9 as active
join query_7 as total on active.ga_dimension1 = total.role
order by Role;
</code></pre>
<p>This was working ok when parameters were hardcoded but it fails now. Is it correct that for now, it’s not possible to get the results like this with global parameters? If so, what a workaround could be?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_4' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-01T05:38:25Z' class='post-time'>
                    August 1, 2018,  5:38am
                  </time>
                  <meta itemprop='dateModified' content='2018-08-01T05:38:25Z'>
              <span itemprop='position'>4</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi <a class="mention" href="/u/ariarijp">@ariarijp</a>, I tried your pull request with the current master (5.0.0-beta) but with no success, unfortunately – my existing queries became broken, e.g. <code>select * from query_7 as users where users.role = 'staff'</code> complains about missing <code>users.role</code> column. It works ok in master, however.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_5' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-08-15T06:10:43Z' class='post-time'>
                    August 15, 2018,  6:10am
                  </time>
                  <meta itemprop='dateModified' content='2018-08-15T06:10:43Z'>
              <span itemprop='position'>5</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/arikfr">@arikfr</a>, I tried <a class="mention" href="/u/ariarijp">@ariarijp</a> solution with the current master but got <code>Error running query: 'query_9' is not a function</code>. Was something changed since March that could break the patch? I did <code>git log -- redash/query_runner</code> but can’t see anything suspicious. What else could I do to troubleshoot the issue?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="2" />
              </div>

          </div>
          <div id='post_6' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-17T06:53:16Z' class='post-time'>
                    September 17, 2018,  6:53am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-17T06:53:16Z'>
              <span itemprop='position'>6</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi <a class="mention" href="/u/leshik">@leshik</a> ,</p>
<p>Thank you for your feedback!<br>
I will check my patch on 5.0.0 branch.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

          </div>
          <div id='post_7' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-17T08:03:56Z' class='post-time'>
                    September 17, 2018,  8:03am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-17T08:03:56Z'>
              <span itemprop='position'>7</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> I’ve checked that PoC on master branch commit <code>47068a6d911716cc2802542cdc5613e14602d561</code>.</p>
<p>It’s looks like works for me.</p>
<p>Here is my queries,</p>
<p>Query 1 (It uses Redash metadata as a data source)</p>
<pre><code class="lang-auto">SELECT *
FROM EVENTS
WHERE action = '{{ action }}'
  AND object_type = '{{ object_type }}';
</code></pre>
<p>Query 2</p>
<pre><code class="lang-sql">SELECT *
FROM query_1('{"action":"view", "object_type":"query"}');
</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="2" />
              </div>

          </div>
          <div id='post_8' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-17T08:44:33Z' class='post-time'>
                    September 17, 2018,  8:44am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-17T08:44:33Z'>
              <span itemprop='position'>8</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/ariarijp">@ariarijp</a> do you have a patch against the current master? maybe I messed things up when trying to apply your patch.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_9' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-17T11:28:53Z' class='post-time'>
                    September 17, 2018, 11:28am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-17T11:28:53Z'>
              <span itemprop='position'>9</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> Sure, here you are.</p>
<pre><code class="lang-diff">diff --git a/redash/query_runner/query_results.py b/redash/query_runner/query_results.py
index fc0e09e4..db8fcf08 100644
--- a/redash/query_runner/query_results.py
+++ b/redash/query_runner/query_results.py
@@ -1,9 +1,12 @@
+import hashlib
 import json
 import logging
 import numbers
 import re
 import sqlite3
 
+import pystache
+import sqlparse
 from dateutil import parser
 
 from redash import models
@@ -42,9 +45,23 @@ def _guess_type(value):
     return TYPE_STRING
 
 
-def extract_query_ids(query):
-    queries = re.findall(r'(?:join|from)\s+query_(\d+)', query, re.IGNORECASE)
-    return [int(q) for q in queries]
+def extract_child_queries(query):
+    pattern = re.compile(r"^query_(\d+)(?:\('(\{.+\})'\))?", re.IGNORECASE)
+    queries = []
+
+    for token in sqlparse.parse(query)[0].tokens:
+        m = pattern.match(token.value)
+        if not m:
+            continue
+
+        queries.append({
+            'query_id': int(m.group(1)),
+            'params': {} if m.group(2) is None else json.loads(m.group(2)),
+            'table': 'tmp_' + hashlib.md5(token.value).hexdigest(),
+            'token': token.tokens[0].value if isinstance(token.tokens[0], sqlparse.sql.Function) else token.value,
+        })
+
+    return queries
 
 
 def _load_query(user, query_id):
@@ -54,26 +71,34 @@ def _load_query(user, query_id):
         raise PermissionError("Query id {} not found.".format(query.id))
 
     if not has_access(query.data_source.groups, user, not_view_only):
-        raise PermissionError(u"You are not allowed to execute queries on {} data source (used for query id {}).".format(
-            query.data_source.name, query.id))
+        raise PermissionError(
+            u"You are not allowed to execute queries on {} data source (used for query id {}).".format(
+                query.data_source.name, query.id))
 
     return query
 
 
-def create_tables_from_query_ids(user, connection, query_ids):
-    for query_id in set(query_ids):
-        query = _load_query(user, query_id)
+def create_tables_from_child_queries(user, connection, query, child_queries):
+    for child_query in child_queries:
+        _query = _load_query(user, child_query['query_id'])
 
-        results, error = query.data_source.query_runner.run_query(
-            query.query_text, user)
+        params = child_query['params']
+        if not params:
+            params = _get_default_params(_query)
+
+        query_with_params = pystache.render(_query.query_text, params)
+        results, error = _query.data_source.query_runner.run_query(query_with_params, user)
 
         if error:
             raise Exception(
-                "Failed loading results for query id {}.".format(query.id))
+                "Failed loading results for query id {}.".format(_query.id))
 
         results = json.loads(results)
-        table_name = 'query_{query_id}'.format(query_id=query_id)
+        table_name = child_query['table']
         create_table(connection, table_name, results)
+        query = query.replace(child_query['token'], table_name)
+
+    return query
 
 
 def fix_column_name(name):
@@ -101,6 +126,16 @@ def create_table(connection, table_name, query_results):
         connection.execute(insert_template, values)
 
 
+def _get_default_params(query):
+    params = {}
+
+    if 'parameters' in query.options:
+        for p in query.options['parameters']:
+            params[p['name']] = p['value']
+
+    return params
+
+
 class Results(BaseQueryRunner):
     noop_query = 'SELECT 1'
 
@@ -118,13 +153,13 @@ class Results(BaseQueryRunner):
 
     @classmethod
     def name(cls):
-        return "Query Results (Beta)"
+        return "Query Results Ex(Beta)"
 
     def run_query(self, query, user):
         connection = sqlite3.connect(':memory:')
 
-        query_ids = extract_query_ids(query)
-        create_tables_from_query_ids(user, connection, query_ids)
+        child_queries = extract_child_queries(query)
+        query = create_tables_from_child_queries(user, connection, query, child_queries)
 
         cursor = connection.cursor()
 
</code></pre>
<p>Good luck!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_10' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">

                <link itemprop="image" href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c435763a527dfdcab53e4d2b320cad7fd490a872.png">

              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T03:16:08Z' class='post-time'>
                    September 18, 2018,  3:16am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T03:16:08Z'>
              <span itemprop='position'>10</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/ariarijp">@ariarijp</a> Sorry, but I can’t make it work even using your queries. I’m able to execute the first query with parameters:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c435763a527dfdcab53e4d2b320cad7fd490a872.png" data-download-href="/uploads/short-url/rZK7MYIYS4LKF7GdCc1kzSmoa2K.png?dl=1" title="56" rel="noopener nofollow ugc"><img src="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/c435763a527dfdcab53e4d2b320cad7fd490a872_2_690x384.png" alt="56" data-base62-sha1="rZK7MYIYS4LKF7GdCc1kzSmoa2K" width="690" height="384" srcset="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/c435763a527dfdcab53e4d2b320cad7fd490a872_2_690x384.png, https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/c435763a527dfdcab53e4d2b320cad7fd490a872_2_1035x576.png 1.5x, https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c435763a527dfdcab53e4d2b320cad7fd490a872.png 2x" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/c435763a527dfdcab53e4d2b320cad7fd490a872_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">56</span><span class="informations">1038×579 36.4 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>But the second one fails:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/432b05349fc08a872c4641461430e5c3fe4d68aa.png" data-download-href="/uploads/short-url/9Ac9ZvclSTNydzlWLe1WcMFuMdA.png?dl=1" title="33" rel="noopener nofollow ugc"><img src="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/432b05349fc08a872c4641461430e5c3fe4d68aa_2_690x256.png" alt="33" data-base62-sha1="9Ac9ZvclSTNydzlWLe1WcMFuMdA" width="690" height="256" srcset="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/432b05349fc08a872c4641461430e5c3fe4d68aa_2_690x256.png, https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/432b05349fc08a872c4641461430e5c3fe4d68aa_2_1035x384.png 1.5x, https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/432b05349fc08a872c4641461430e5c3fe4d68aa.png 2x" data-small-upload="https://global.discourse-cdn.com/standard17/uploads/redash1/optimized/1X/432b05349fc08a872c4641461430e5c3fe4d68aa_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use href="#far-image"></use></svg><span class="filename">33</span><span class="informations">1039×386 21.6 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>What might be the reason?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_11' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T03:20:28Z' class='post-time'>
                    September 18, 2018,  3:20am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T03:20:28Z'>
              <span itemprop='position'>11</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>More logs:</p>
<pre><code class="lang-auto">[2018-09-18 03:13:14,069][PID:73][INFO][Worker-21] task_name=redash.tasks.execute_query taks_id=a6c55223-e6d2-4d4c-ab64-8dd6c8176cb0 task=execute_query query_hash=a5010a00aaf69c88c09e36b60d1212c9 data_length=None error=[function query_19(unknown) does not exist
LINE 2: FROM query_19('{"action":"view", "object_type":"query"}');
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
]
[2018-09-18 03:13:14,074][PID:1][ERROR][MainProcess] Task redash.tasks.execute_query[a6c55223-e6d2-4d4c-ab64-8dd6c8176cb0] raised unexpected: QueryExecutionError('function query_19(unknown) does not exist\nLINE 2: FROM query_19(\'{"action":"view", "object_type":"query"}\');\n             ^\nHINT:  No function matches the given name and argument types. You might need to add explicit type casts.\n',)
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/celery/app/trace.py", line 240, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/app/redash/worker.py", line 71, in __call__
    return TaskBase.__call__(self, *args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/celery/app/trace.py", line 438, in __protected_call__
    return self.run(*args, **kwargs)
  File "/app/redash/tasks/queries.py", line 528, in execute_query
    scheduled_query).run()
  File "/app/redash/tasks/queries.py", line 470, in run
    raise result
QueryExecutionError: function query_19(unknown) does not exist
LINE 2: FROM query_19('{"action":"view", "object_type":"query"}');
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
</code></pre>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_12' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T05:08:52Z' class='post-time'>
                    September 18, 2018,  5:08am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T05:08:52Z'>
              <span itemprop='position'>12</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> Hmm, which data source type are you using?</p>
<pre><code class="lang-auto">HINT:  No function matches the given name and argument types.
</code></pre>
<p>It looks like an error from PostgreSQL.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_13' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T06:04:04Z' class='post-time'>
                    September 18, 2018,  6:04am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T06:18:32Z'>
              <span itemprop='position'>13</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/ariarijp">@ariarijp</a> As you suggested, I’m using re:dash DB as data source. So I just added its postgres DB to my data sources.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_14' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T07:36:37Z' class='post-time'>
                    September 18, 2018,  7:36am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T07:36:37Z'>
              <span itemprop='position'>14</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> I see, Can you run your second query on Query Results Data Source?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_15' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T08:09:21Z' class='post-time'>
                    September 18, 2018,  8:09am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T08:09:21Z'>
              <span itemprop='position'>15</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/ariarijp">@ariarijp</a> omg, I’m so sorry for wasting your time, I just forgot to change the data source in the query editor. It works now with your provided example as well as with my case with GA. I will experiment more and will let you know if I hit some edge case. Thank you!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="1" />
              <span class='post-likes'>1 Like</span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_16' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T08:23:10Z' class='post-time'>
                    September 18, 2018,  8:23am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T08:23:10Z'>
              <span itemprop='position'>16</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> Great! Happy Redash-ing! :redash:</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_17' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/leshik'><span itemprop='name'>leshik</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T09:26:16Z' class='post-time'>
                    September 18, 2018,  9:26am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T09:26:16Z'>
              <span itemprop='position'>17</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/ariarijp">@ariarijp</a> I figured out what was breaking my queries. After the PoC patch, it’s not possible to use queries like this one anymore:</p>
<pre><code class="lang-auto">select total.school
from query_7 as total;
</code></pre>
<p>This works on current master, but stops after applying the patch. Before the patch, this query succeds, but after it fails with <code>Error running query: no such column: total.school</code>.</p>
<p>My queries rely on joins that depend on tables aliases so they stopped working.</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_18' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/ariarijp'><span itemprop='name'>ariarijp</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-09-18T11:08:13Z' class='post-time'>
                    September 18, 2018, 11:08am
                  </time>
                  <meta itemprop='dateModified' content='2018-09-18T11:08:13Z'>
              <span itemprop='position'>18</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p><a class="mention" href="/u/leshik">@leshik</a> Thank you for your feedback!</p>
<p>I understand what is annoying you.</p>
<p>For now, It is one of the limitations of this PoC.</p>
<p>Of course, I always welcome any patch for solving it <img src="https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
          <div id='post_19' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/Tim'><span itemprop='name'>Tim</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-10-09T13:38:29Z' class='post-time'>
                    October 9, 2018,  1:38pm
                  </time>
                  <meta itemprop='dateModified' content='2018-10-09T13:38:29Z'>
              <span itemprop='position'>19</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Is it possible to do things like that?<br>
<code>FROM query_254('{"mindate":'{{ mindate }}', "maxdate":'{{ maxdate }}'}');</code><br>
This doesn’t work because of the brackets. Am I doing this wrong or are parameters into parameters not  supported?</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="0" />
              </div>

                <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                      <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                        <a itemprop='url' href="http://discuss.redash.io/t/passing-query-paramters-into-a-interal-query-from-parent-query/8036">Passing query paramters into a interal query from parent query</a>
                        <meta itemprop='position' content='1'>
                      </div>
                </div>
          </div>
          <div id='post_20' itemprop='comment' itemscope itemtype='http://schema.org/Comment' class='topic-body crawler-post'>
            <div class='crawler-post-meta'>
              <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <a itemprop="url" href='https://discuss.redash.io/u/LeoRochael'><span itemprop='name'>LeoRochael</span></a>
                
              </span>

              <link itemprop="mainEntityOfPage" href="https://discuss.redash.io/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709">


              <span class="crawler-post-infos">
                  <time itemprop='datePublished' datetime='2018-10-26T13:58:01Z' class='post-time'>
                    October 26, 2018,  1:58pm
                  </time>
                  <meta itemprop='dateModified' content='2018-10-26T13:58:01Z'>
              <span itemprop='position'>20</span>
              </span>
            </div>
            <div class='post' itemprop='text'>
              <p>Hi Arikfr,</p>
<p>First let me start by saying that redash is awesome, thank you for open-sourcing it and most of all thank you for engaging so actively with the community that sprung around it!</p>
<p>As for adding support for queries with parameters, I believe that the best way to implement it would be to  lean on sqlite’s native support for user-defined table-returning functions.</p>
<p>These can be implemented in Python with the help of either the <a href="https://github.com/coleifer/sqlite-vtfunc" rel="nofollow noopener">sqlite-vtfunc</a> module or Peewee’s <a href="http://docs.peewee-orm.com/en/latest/peewee/api.html#SqliteDatabase.table_function" rel="nofollow noopener"><code>TableFunction</code> class</a>.</p>
<p>(For the purposes of the rest of this discussion, I’m going call the queries from other data sources as “source queries” and the query that runs on sqlite based on the “source queries” as “sink query”).</p>
<p>Implementing query results as table functions brings ancillary benefits:</p>
<ul>
<li>
<p>No need to invent new syntax. Passing parameters  declared on the sink query to a source query is simply a matter of doing “<code>select * from query_175({{parameter}})</code>” whereas passing a correlated value from the sink query into the source query can be achieved with something like:</p>
<p><code>select record.title, ( select count(*) from query_175(record.id)), from record</code></p>
</li>
<li>
<p>The source queries wouldn’t need to be executed completely before running the sink query. On the contrary, the sink query actually runs first, and the source queries only need to produce as much data as the sink query consumes, allowing the queries to run in parallel</p>
<ul>
<li>This solves a pet peeve of mine, where the source queries are completely executed before the sink query fails with a syntax error when there is something a simple as a missing comma on the sink query.</li>
</ul>
</li>
</ul>
<p>Since these functions need to be pre-declared before running the query in sqlite, this would require parsing the query, as is currently done, to locate which existing queries should be declared as table functions.</p>
<p>Alternatively, the data source could require configuration of which source queries should be available to sink queries (and perhaps even their names!), which would also help to serve as a sort of access control. This would allow removing all code that currently parses sink queries to locate the source queries.</p>
<p>Using json in the argument passing, as suggested by <a class="mention" href="/u/ariarijp">@ariarijp</a>, is also a possibility which could help with mapping arguments passed in the sink query with parameters declared in the source queries, which otherwise would need some sort of convention about the order of parameters.</p>
<p>These are my thoughts on the matter.</p>
<p>Again, thank you for engaging with the community on this matter!</p>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
              <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
              <meta itemprop="userInteractionCount" content="0" />
              <span class='post-likes'></span>
            </div>

            <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
                <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
                <meta itemprop="userInteractionCount" content="1" />
              </div>

          </div>
    </div>

    <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
        <span itemprop='name'><b><a rel="next" itemprop="url" href="/t/thoughts-on-adding-support-for-queries-with-parameters-in-query-results-data-source/1709?page=2">next page →</a></b></span>
    </div>





    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='http://redash.io/terms.html' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='http://redash.io/privacy.html' itemprop="url">Privacy Policy </a>
          </span>
        </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
