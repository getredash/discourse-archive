<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>Supporting Dynamic Snippets</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i>¬†Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>‚ñº</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>‚ñº</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            ¬© 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/supporting-dynamic-snippets/3118">Supporting Dynamic Snippets</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">Feature Requests</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="Supporting Dynamic Snippets" itemprop="headline"/>
<meta content="Feature Requests" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/dengwanc.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/dengwanc_avatar.png" tabindex="-1" width="48"/><span itemprop="name">dengwanc</span></a>
</span>
<link href="https://discuss.redash.io/t/supporting-dynamic-snippets/3118" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-01-30T09:49:43Z" itemprop="datePublished">
                    January 30, 2019,  9:49am
                  </time>
<meta content="2019-01-30T11:39:02Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>If I create a very common query snippet. I want use it like variable.<br/>
For example:<br/>
I create a snippet, named <code>dau_metrics</code></p>
<pre><code class="lang-auto">select dau_d, uid, level 
from profile.users 
where today()-30 &lt;= d
</code></pre>
<p>And I use the snippet like that:</p>
<pre><code class="lang-auto">select count(*) cnt, uid 
from work_exp 
inner join (${dau_metrics}) using uid group by uid
</code></pre>
<p><strong>Use variable instead of just copy the snippet code here.</strong></p>
<p>The good part is:</p>
<ol>
<li>if I change dau_metrics, all the query depend on <code>dau_metrics</code> will be changed on the execute runtime</li>
<li>if I join many tables, make the SQL looks more short and clear</li>
</ol>
<p>The bad part is:</p>
<ol>
<li>maybe hard implement</li>
<li>debug the final generated long SQL maybe difficult</li>
</ol>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/supporting-dynamic-snippets/3118" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-01-30T10:57:35Z" itemprop="datePublished">
                    January 30, 2019, 10:57am
                  </time>
<meta content="2019-01-30T10:57:35Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Supporting Dynamic Snippets is something I wanted to implement for a long time. If indeed issue <span class="hashtag">#2</span> (debugging the final generated SQL) will be hard, we can help with that by making it possible to see the ‚Äúrendered query‚Äù with the snippets embedded.</p>
<p>In terms of actual implementation, it makes sense to use the templating engine we use for parameters. Currently it‚Äôs Mustache, it‚Äôs somewhat limited but has support for partials, which we can use to implement this.</p>
<p>Partials look like this in the template <code>{{&gt;dau_metrics}}</code>. The Engine itself has support for passing an object that defines how to load the partials, and I even have an experiment implementation for this (consists of 7 lines of code, but needs more work to be ‚Äúproduction grade‚Äù).</p>
<p>The downsides I can see with such implementation:</p>
<ol>
<li>No support for insertion points (see <a href="https://redash.io/help/user-guide/querying/query-snippets" rel="nofollow noopener">here</a>), which regular snippets support. In your example, you might want the number of days to be something the user can pass to the snippet.</li>
<li>The syntax is not very welcoming, but that‚Äôs not a huge thing.</li>
<li>It‚Äôs makes it harder for us to migrate away from Mustache if we would like to implement more sophisticated features in the future (like <a href="https://github.com/getredash/redash/issues/3011" rel="nofollow noopener">Optional Parameters</a>).</li>
</ol>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="3" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/dengwanc.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/dengwanc_avatar.png" tabindex="-1" width="48"/><span itemprop="name">dengwanc</span></a>
</span>
<link href="https://discuss.redash.io/t/supporting-dynamic-snippets/3118" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-01-30T11:32:15Z" itemprop="datePublished">
                    January 30, 2019, 11:32am
                  </time>
<meta content="2019-01-30T11:42:14Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thx for reply</p>
<blockquote>
<ol>
<li>the user can pass to the snippet</li>
</ol>
</blockquote>
<p>for this, can I write something like this  <code>today()-{{day_range}} &lt;= d</code> in the snippet ?</p>
<blockquote>
<ol start="2">
<li>It‚Äôs makes it harder for us to migrate away from Mustache</li>
</ol>
</blockquote>
<p>for this, I dont have any good idea, it‚Äôs something like compile the user code get a result and compile the result code again, get the final SQL code.</p>
<pre><code class="lang-auto">dau_metrics=select dau_d, uid, level from profile.users where today()-{{day_range}} &lt;= d

üëá

select * from ${dau_metric}

üëáengine compile or provide a [generate] button on the GUI

select * from (select dau_d, uid, level from profile.users where today()-{{day_range}} &lt;= d)

üëáuser typed 30

select * from (select dau_d, uid, level from profile.users where today()-30 &lt;= d)
</code></pre>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/jesse.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/jesse_avatar.png" tabindex="-1" width="48"/><span itemprop="name">jesse</span></a>
</span>
<link href="https://discuss.redash.io/t/supporting-dynamic-snippets/3118" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-01-30T12:37:58Z" itemprop="datePublished">
                    January 30, 2019, 12:37pm
                  </time>
<meta content="2019-01-30T12:37:58Z" itemprop="dateModified"/>
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote group-Team" data-post="2" data-topic="3118">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="assets/2_2.png" width="20"/> arikfr:</div>
<blockquote>
<p>In terms of actual implementation, it makes sense to use the templating engine we use for parameters.</p>
</blockquote>
</aside>
<p>You could solve the de-coupling issue by writing your own functions to do this. Python and JS both have decent parameter substitution syntax (<code>f strings</code> in Python3 and string literal templates in JS). The template language gives you input safety ‚Äì but this can still be handled with custom code.</p>
<p>Personally, I think it makes sense to use Mustache. And just figure the migration overhead into the cost / benefit analysis when switching template languages in the future.</p>
<p>In my experience, migrating this kind of functionality from one platform to another is pretty straightforward as long as you have a solid suite of unit tests.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/jesse.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/jesse_avatar.png" tabindex="-1" width="48"/><span itemprop="name">jesse</span></a>
</span>
<link href="https://discuss.redash.io/t/supporting-dynamic-snippets/3118" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2019-01-30T12:40:52Z" itemprop="datePublished">
                    January 30, 2019, 12:40pm
                  </time>
<meta content="2019-01-30T12:40:52Z" itemprop="dateModified"/>
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote group-Team" data-post="2" data-topic="3118">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="assets/2_2.png" width="20"/> arikfr:</div>
<blockquote>
<p>No support for insertion points (see <a href="https://redash.io/help/user-guide/querying/query-snippets" rel="nofollow noopener">here</a>), which regular snippets support. In your example, you might want the number of days to be something the user can pass to the snippet.</p>
</blockquote>
</aside>
<p>Periscope Data does it with what I would describe as ‚Äúfunction syntax‚Äù. You define a query snippet with a function signature very similar to a programming language:</p>
<pre><code class="lang-python">snippet_name(param1, param2, param3)
</code></pre>
<p>And then use it in your query by wrapping in square brackets:</p>
<pre><code class="lang-auto">SELECT * FROM events WHERE [snippet_name('a', 'b', 'c')]
</code></pre>
<p>It‚Äôs quite functional. But unless you have <strong>really</strong> descriptive query snippet names it can make queries hard to reason about.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>