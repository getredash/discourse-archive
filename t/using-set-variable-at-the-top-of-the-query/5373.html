<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet"/>
<link href="../../css/checklist_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/desktop_theme_2_be4cb2b86ec06123c5e974acd20fd933d14b129d.css" rel="stylesheet"/>
<link href="../../css/discourse-adplugin_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-akismet_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-cakeday_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-chat-integration_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-details_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-footnote_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-lazy-videos_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/discourse-local-dates_d86c892d7cd5311243d31a8f11787f4b0342874d.css" rel="stylesheet"/>
<link href="../../css/color_definitions_base__2_8fd59ae1f286f43b3ff17996df07ea951685249d.css" rel="stylesheet"/>
<link href="../../css/style.css" rel="stylesheet"/>
<title>Using "SET" variable at the top of the query</title></head>
<body>
<div class="navbar">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<div class="navbar-buttons">
<button class="btn btn-signup">Sign Up</button>
<button class="btn btn-login"><i class="fas fa-user"></i> Login</button>
<button class="btn btn-search"><i class="fas fa-search"></i></button>
<div class="navbar-toggle">
<div class="dots"></div>
<div class="dots"></div>
<div class="dots"></div>
</div>
</div>
</div>
<div class="sidebar">
<div class="sidebar-content">
<div class="logo"><a href="../../page_0.html"><img alt="" src="../../images/logo_redash.png" srcset=""/></a></div>
<ul class="sidebar-grid">
<!-- <li><a href="#"><i class="fas fa-list-ul"></i> Topics</a></li> -->
<li><a href="../../page_0.html"><i class="fas fa-layer-group"></i> Topics</a></li>
<li><a href="../../users.html"><i class="fas fa-users"></i> Users</a></li>
<li><a href="../../about.html"><i class="fas fa-info-circle"></i> About</a></li>
<li><a href="../../faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
<li><a href="../../groups.html"><i class="fas fa-users"></i> Groups</a></li>
<li><a href="../../badges.html"><i class="fas fa-certificate"></i> Badges</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#categories"><span>▼</span>Categories</a></h3>
<hr/>
<ul class="sidebar-grid categories">
<li>
<a class="badge-wrapper bullet" href="../../c/support/6.html">
<span class="badge-category-bg" style="background-color: #BF1E2E"></span>
<span class="badge-category clear-badge">
<span class="category-name">Support</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/feature-requests/5.html">
<span class="badge-category-bg" style="background-color: #3AB54A"></span>
<span class="badge-category clear-badge">
<span class="category-name">Feature Requests</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/uncategorized/1.html">
<span class="badge-category-bg" style="background-color: #AB9364"></span>
<span class="badge-category clear-badge">
<span class="category-name">Uncategorized</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/development/7.html">
<span class="badge-category-bg" style="background-color: #8C6238"></span>
<span class="badge-category clear-badge">
<span class="category-name">Development</span>
</span>
</a>
</li>
<li>
<a class="badge-wrapper bullet" href="../../c/tips-tricks-query-examples/11.html">
<span class="badge-category-bg" style="background-color: #652D90"></span>
<span class="badge-category clear-badge" style="white-space: normal;">
<span class="category-name">Tips, Tricks &amp; Query Examples</span>
</span>
</a>
</li>
<li><a href="../../categories.html"><i class="fas fa-list-ul"></i> All categories</a></li>
</ul>
<h3 style="font-size: 13px;"><a href="#tags"><span>▼</span>Tags</a></h3>
<hr/>
<ul class="sidebar-grid tags">
<li><a href="../../tag/query_results.html"><i class="fas fa-tag"></i> query_results</a></li>
<li><a href="../../tag/feature-request.html"><i class="fas fa-tag"></i> feature-request</a></li>
<li><a href="../../tag/parameters.html"><i class="fas fa-tag"></i> parameters</a></li>
<li><a href="../../tag/visualizations.html"><i class="fas fa-tag"></i> visualizations</a></li>
<li><a href="../../tag/alerts.html"><i class="fas fa-tag"></i> alerts</a></li>
<li><a href="../../tags.html"><i class="fas fa-list-ul"></i> All tags</a></li>
</ul>
</div>
<div class="sidebar-footer">
            © 2023 <a href="https://discuss.redash.io/" target="_blank">discuss.redash.io</a>
</div>
</div>
<div class="overlay"></div>
<div class="content">
<div class="global-notice">
<div class="row">
<div class="alert alert-info alert-read-only" id="global-notice-alert-read-only">
<span class="text">This site is in read only mode. Please continue to browse, but replying, likes,
                        and other actions are disabled for now.</span>
</div>
</div>
</div>
<div class="imported_page" id="imported_page">
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="/t/using-set-variable-at-the-top-of-the-query/5373">Using "SET" variable at the top of the query</a>
</h1>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content='Using "SET" variable at the top of the query' itemprop="headline"/>
<meta content="Uncategorized" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Redash Discourse" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="https://global.discourse-cdn.com/standard17/uploads/redash1/original/1X/c07bc573841e1e4a0013ea3b6fe088a1534228a3.png" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/victordek.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/victordek_avatar.png" tabindex="-1" width="48"/><span itemprop="name">victordek</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-19T10:56:10Z" itemprop="datePublished">
                    January 19, 2020, 10:56am
                  </time>
<meta content="2020-01-19T10:56:10Z" itemprop="dateModified"/>
<span itemprop="position">1</span>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>Hey!<br/>
We work with a Snoflake DB. When running queries in workbench (/others) we use this syntax a lot:</p>
<pre><code>set LAST_DAYS = (select DATE_PART('EPOCH_MILLISECOND', TO_TIMESTAMP(current_timestamp)) / 1000 - 60 * 60 * 24 * 10);

select * from table

where  table.TIMESTAMP&gt; $last_days
</code></pre>
<p>is this doable in REDASH?<br/>
I run the top row separately - statement executes successfully.<br/>
Then I try to run the rest of the query, but redash says " SQL compilation error: error line 3 at position 26 Session variable ‘$LAST_DAYS’ does not exist"</p>
<p>(the same sequance does work with this DB in other tools -  workbench/data-grip etc)</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-20T12:25:13Z" itemprop="datePublished">
                    January 20, 2020, 12:25pm
                  </time>
<meta content="2020-01-20T12:25:13Z" itemprop="dateModified"/>
<span itemprop="position">2</span>
</span>
</div>
<div class="post" itemprop="text">
<aside class="quote no-group" data-post="1" data-topic="5373" data-username="victordek">
<div class="title">
<div class="quote-controls"></div>
<img alt="" class="avatar" height="20" src="https://avatars.discourse-cdn.com/v4/letter/v/dfb087/40.png" width="20"/> victordek:</div>
<blockquote>
<p>Then I try to run the rest of the query</p>
</blockquote>
</aside>
<p>Together with the first part? I.e. just hit execute on the whole query?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/victordek.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/victordek_avatar.png" tabindex="-1" width="48"/><span itemprop="name">victordek</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-20T12:50:25Z" itemprop="datePublished">
                    January 20, 2020, 12:50pm
                  </time>
<meta content="2020-01-20T12:50:25Z" itemprop="dateModified"/>
<span itemprop="position">3</span>
</span>
</div>
<div class="post" itemprop="text">
<p>tried it different ways.</p>
<p>originally I tried executing the SET line, and then the rest of the query (separately) - that’s how I usually do it in datagrip. I get an the error</p>
<blockquote>
<p><strong>SQL compilation error: error line 2 at position 25 Session variable ‘$LAST_DAYS’ does not exist</strong></p>
</blockquote>
<p>if I try to run the SET line, and then run the whole query (both parts) I get</p>
<blockquote>
<p><strong>001003 (42000): SQL compilation error: syntax error line 3 at position 0 unexpected ‘select’.</strong></p>
</blockquote>
<p>if i add a “;” after the SET line, I get</p>
<blockquote>
<p><strong>Multiple SQL statements in a single API call are not supported; use one API call per statement instead.</strong></p>
</blockquote>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/arikfr.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/arikfr_avatar.png" tabindex="-1" width="48"/><span itemprop="name">arikfr</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-20T15:20:37Z" itemprop="datePublished">
                    January 20, 2020,  3:20pm
                  </time>
<meta content="2020-01-20T15:20:37Z" itemprop="dateModified"/>
<span itemprop="position">4</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks, this was helpful! So what happens is that tools like Datagrip run all your queries in the same session. But Redash executes each query in its own session, so this explains why option 1 failed.</p>
<p>Option 2 fails, because you need to split your statements with a <code>;</code>. And option 3 fails because of limitations of their API. We could split the queries into multiple ones and send them one by one in the same session, but I’m not sure if we have a reliable way to do this <img alt=":thinking:" class="emoji" src="assets/thinking.png" title=":thinking:"/></p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">1 Like</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_5" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/victordek.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/victordek_avatar.png" tabindex="-1" width="48"/><span itemprop="name">victordek</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-01-21T14:08:58Z" itemprop="datePublished">
                    January 21, 2020,  2:08pm
                  </time>
<meta content="2020-01-21T14:08:58Z" itemprop="dateModified"/>
<span itemprop="position">5</span>
</span>
</div>
<div class="post" itemprop="text">
<p>Thanks for that!<br/>
can you elaborate on “And option 3 fails because of limitations of their API.” ?</p>
<p>I’ll give smoe context to our use case:<br/>
we save all date/time info in tables in UNIX timestamp format. when running a query to get yesterday’s data (for example), I need to use a filters such as:</p>
<blockquote>
<p>timestamp &gt; date_part(epoch_seconds, current_timestamp) - 60<em>60</em>24*1</p>
</blockquote>
<p>which means that the date function needs to run N times per the number of records (=number of timestamp values).<br/>
we use the SET function to optimise this , and pre-set values of timestamp-limits (so when the main query is running, we only compare timestamp to timestamp)</p>
<p>any ideas how to achieve this in redash?</p>
<p>*I have an idea that can work (i guess) - use a separate query with</p>
<blockquote>
<p>select date_part(epoch_seconds, current_timestamp) - 60<em>60</em>24*1 as min_time</p>
</blockquote>
<p>and call that query in a parameter in the main query.<br/>
I guess this would achieve the same result?<br/>
problems with this-<br/>
1.need to always work with 2 queries - bit annoying.<br/>
2.use of query result in parameter is only by using drop down… not really a blocker, but it’s a “weird” application.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_6" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<a href="../../u/detail/victordek.html" itemprop="url"><img alt="" class="avatar" height="48" loading="lazy" src="../../u/avatars/victordek_avatar.png" tabindex="-1" width="48"/><span itemprop="name">victordek</span></a>
</span>
<link href="https://discuss.redash.io/t/using-set-variable-at-the-top-of-the-query/5373" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2020-02-02T15:59:21Z" itemprop="datePublished">
                    February 2, 2020,  3:59pm
                  </time>
<meta content="2020-02-02T15:59:21Z" itemprop="dateModified"/>
<span itemprop="position">6</span>
</span>
</div>
<div class="post" itemprop="text">
<p><a class="mention" href="/u/arikfr">@arikfr</a>  BTW - I guess what would really solve all my problems here is:<br/>
if I could run SQL <strong>in the parameter</strong>  .  or in other words it’d be a query window inside a query window.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="overlay" id="modalOverlay" style="display: none;">
<div class="modal-content">
<p>Login or sign up disabled while the site is in read only mode</p>
<hr/>
<button class="btn btn-login">OK</button>
</div>
</div>
<script src="../../js/script.js"></script>
</body>
</html>